# English Learning App V2 - Complete Architecture & Implementation Plan

## Executive Summary
Based on comprehensive investigation of the existing system and research into educational platforms like Duolingo, Khan Academy, and SCORM standards, this document outlines the complete plan for V2 - a lightweight, framework-less vanilla TypeScript application focused on structured content management for Global Success curriculum grades 6-12.

## Current System Analysis

### Existing Strengths
- **Rich React/MUI Frontend**: Advanced vocabulary features with teacher-optimized interface
- **Comprehensive Backend**: Node.js/Express with AI integration (Gemini API)
- **Extensive Content Library**: Global Success textbooks grades 6-12 with structured markdown
- **Advanced Features**: 
  - VocabHoot gamification system
  - Teacher dashboard with presentation mode
  - Text-to-speech with voice prioritization
  - Interactive quiz generation
  - Translation helper tools

### Current Architecture
```
Current System:
â”œâ”€â”€ backend/ (Node.js/Express)
â”‚   â”œâ”€â”€ AI services (Gemini integration)
â”‚   â”œâ”€â”€ Markdown processing
â”‚   â”œâ”€â”€ Quiz generation
â”‚   â””â”€â”€ Translation services
â”œâ”€â”€ frontend/ (React + MUI)
â”‚   â”œâ”€â”€ Complex component hierarchy
â”‚   â”œâ”€â”€ Advanced teacher features
â”‚   â””â”€â”€ Vocabulary games
â””â”€â”€ Data (Markdown files organized by grades/units)
```

### Challenges Identified
1. **Framework Dependency**: Heavy React/MUI stack for simple content viewing
2. **Complex Structure**: Over-engineered for basic markdown viewing and vocabulary selection
3. **Missing Structured Format**: Content in markdown lacks structured exercise/vocabulary XML format
4. **Performance**: Heavy bundle size for simple use cases

## V2 Vision & Requirements

### Core Objectives
- **Simplicity**: Lightweight markdown viewer with vocabulary interaction
- **Click-to-Pronounce**: Simple vocabulary pronunciation on click
- **Quiz Generation**: Select content to create vocabulary quizzes
- **Structured Content**: XML-based exercise and vocabulary format
- **Framework-free**: Pure vanilla TypeScript with component architecture

### User Stories
1. **Student**: "I want to view lessons and click vocabulary words to hear pronunciation"
2. **Teacher**: "I want to quickly select vocabulary to create quizzes"
3. **Content Manager**: "I want structured XML format for exercises with translations and explanations"

## Research Findings

### Global Success Curriculum Structure
- **Grades 6-12**: 12 units per grade level
- **Unit Structure**: 7 lessons per unit
  - Getting Started (vocabulary introduction)
  - A Closer Look (grammar focus)
  - Communication and Culture
  - Skills 1 & 2 (reading, writing, listening, speaking)
  - Looking Back & Project
- **Content Types**: Vocabulary, dialogues, exercises, grammar explanations

### Educational Platform Patterns (Duolingo, Khan Academy, Memrise)
- **Duolingo**: JSON-based API structure with user objects, course progress, TTS configuration
- **Khan Academy**: Self-paced learning with rich content organization
- **Memrise**: Gamified vocabulary expansion with flashcards and mnemonics
- **SCORM Standards**: XML manifest files with learning object metadata (LOM)

### Comprehensive XML Schema Documentation

**Complete XML structure is documented in `docs/xml-schema.md` and `docs/exercise-types.md`**

Key XML Structure:
```xml
<unit id="unit-01" title="Hobbies" order="1">
  <vocabulary_bank>
    <vocabulary_item id="hobby" cefr="A1" part_of_speech="noun">
      <word>hobby</word>
      <pronunciation>
        <ipa>/ËˆhÉ’bi/</ipa>
        <audio_files>
          <audio accent="british" file="hobby_uk.mp3"/>
          <audio accent="american" file="hobby_us.mp3"/>
        </audio_files>
      </pronunciation>
      <definition>an activity that you do for pleasure when you are not working</definition>
      <translation lang="vi">sá»Ÿ thÃ­ch</translation>
      <examples>
        <example difficulty="1">My hobby is reading books.</example>
      </examples>
    </vocabulary_item>
  </vocabulary_bank>
  
  <sections>
    <section id="getting-started">
      <exercises>
        <exercise id="ex001" type="multiple_choice" difficulty="2">
          <question>
            <text>What are Trang and Ann talking about?</text>
            <translation>Trang vÃ  Ann Ä‘ang nÃ³i vá» Ä‘iá»u gÃ¬?</translation>
          </question>
          <options>
            <option id="a" correct="true">Hobbies</option>
            <option id="b">School subjects</option>
            <option id="c">Leisure time</option>
          </options>
          <feedback>
            <correct>Excellent! The conversation focuses on hobbies.</correct>
            <incorrect>Review the dialogue again.</incorrect>
          </feedback>
          <vocabulary_focus>
            <ref id="hobby"/>
            <ref id="dollhouse"/>
          </vocabulary_focus>
        </exercise>
      </exercises>
    </section>
  </sections>
</unit>
```

**Exercise Type Definitions:**
See `docs/exercise-types.md` for complete enum and 20+ exercise types including:
- `multiple_choice`, `fill_in_blanks`, `vocabulary_matching` 
- `listening_comprehension`, `pronunciation_practice`
- `grammar_transformation`, `drag_and_drop`
- Each type has detailed XML structure and rendering requirements

## V2 Architecture Design

### Project Structure
```
v2/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ audio/                 # Pronunciation files
â”‚   â””â”€â”€ assets/               # Images, icons
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # Vanilla TS components
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ Component.ts  # Base component class
â”‚   â”‚   â”‚   â””â”€â”€ EventBus.ts   # Simple event system
â”‚   â”‚   â”œâ”€â”€ MarkdownViewer/
â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownViewer.ts
â”‚   â”‚   â”‚   â””â”€â”€ MarkdownViewer.css
â”‚   â”‚   â”œâ”€â”€ VocabularyCard/
â”‚   â”‚   â”‚   â”œâ”€â”€ VocabularyCard.ts
â”‚   â”‚   â”‚   â””â”€â”€ VocabularyCard.css
â”‚   â”‚   â”œâ”€â”€ QuizGenerator/
â”‚   â”‚   â”‚   â”œâ”€â”€ QuizGenerator.ts
â”‚   â”‚   â”‚   â””â”€â”€ QuizGenerator.css
â”‚   â”‚   â”œâ”€â”€ AudioPlayer/
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioPlayer.ts
â”‚   â”‚   â”‚   â””â”€â”€ AudioPlayer.css
â”‚   â”‚   â””â”€â”€ RecentLessons/
â”‚   â”‚       â”œâ”€â”€ RecentLessons.ts
â”‚   â”‚       â””â”€â”€ RecentLessons.css
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ContentService.ts  # Load/parse XML content
â”‚   â”‚   â”œâ”€â”€ AudioService.ts    # TTS and audio playback
â”‚   â”‚   â”œâ”€â”€ QuizService.ts     # Quiz generation logic
â”‚   â”‚   â””â”€â”€ StorageService.ts  # LocalStorage management
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ XMLParser.ts       # XML parsing utilities
â”‚   â”‚   â”œâ”€â”€ DOMUtils.ts        # DOM manipulation helpers
â”‚   â”‚   â””â”€â”€ TextUtils.ts       # Text processing utilities
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ Content.ts         # Content type definitions
â”‚   â”‚   â”œâ”€â”€ Quiz.ts            # Quiz type definitions
â”‚   â”‚   â””â”€â”€ User.ts            # User progress types
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ main.css           # Global styles
â”‚   â”‚   â”œâ”€â”€ variables.css      # CSS custom properties
â”‚   â”‚   â””â”€â”€ responsive.css     # Mobile responsive rules
â”‚   â””â”€â”€ main.ts                # Application entry point
â”œâ”€â”€ data/
â”‚   â””â”€â”€ structured/            # XML content files
â”‚       â”œâ”€â”€ grade-6/
â”‚       â”œâ”€â”€ grade-7/
â”‚       â”œâ”€â”€ grade-8/
â”‚       â”œâ”€â”€ grade-9/
â”‚       â”œâ”€â”€ grade-10/
â”‚       â”œâ”€â”€ grade-11/
â”‚       â””â”€â”€ grade-12/
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ content-converter/     # Markdown to XML conversion
â”œâ”€â”€ vite.config.ts            # Build configuration
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### Core Components Design

#### 1. Base Component Architecture
```typescript
// src/components/core/Component.ts
abstract class Component<T = {}> {
  protected element: HTMLElement;
  protected props: T;
  
  constructor(props: T) {
    this.props = props;
    this.element = this.createElement();
    this.bindEvents();
  }
  
  abstract createElement(): HTMLElement;
  abstract bindEvents(): void;
  
  render(container: HTMLElement): void {
    container.appendChild(this.element);
  }
  
  destroy(): void {
    this.element.remove();
  }
}
```

#### 2. MarkdownViewer Component
```typescript
interface MarkdownViewerProps {
  content: string;
  onVocabularyClick: (word: VocabularyItem) => void;
  highlightVocabulary: boolean;
}

class MarkdownViewer extends Component<MarkdownViewerProps> {
  // Lightweight markdown parsing
  // Vocabulary word highlighting and click handling
  // Content navigation
}
```

#### 3. VocabularyCard Component
```typescript
interface VocabularyCardProps {
  word: VocabularyItem;
  showTranslation: boolean;
  onPronounce: (audioUrl: string) => void;
  onSelect: (word: VocabularyItem) => void;
}

class VocabularyCard extends Component<VocabularyCardProps> {
  // Interactive vocabulary display
  // Pronunciation button
  // Selection for quiz generation
}
```

### Technical Specifications

#### Build System
- **Vite**: Fast development and build tool for TypeScript
- **No Framework Dependencies**: Pure vanilla implementation
- **CSS Modules**: Scoped styling per component
- **TypeScript**: Strong typing throughout

#### Styling Approach
```css
/* CSS Custom Properties for theming */
:root {
  --primary-color: #2563eb;
  --success-color: #10b981;
  --error-color: #ef4444;
  --text-primary: #111827;
  --text-secondary: #6b7280;
  --background: #f9fafb;
  --card-background: #ffffff;
  --border-radius: 0.75rem;
  --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
}
```

#### Audio Integration
```typescript
class AudioService {
  private audioContext: AudioContext;
  private audioCache: Map<string, AudioBuffer>;
  
  // Web Audio API for pronunciation
  // Audio file caching for performance
  // TTS fallback integration
}
```

### Data Structure & XML Schema

#### Comprehensive XML Format
```xml
<?xml version="1.0" encoding="UTF-8"?>
<curriculum xmlns="http://english-learning-app.com/schema/v2">
  <grade level="7" cefr_level="A1-A2">
    <unit id="unit-01" title="Hobbies" order="1">
      <metadata>
        <description>Introduction to hobbies and leisure activities</description>
        <learning_objectives>
          <objective>Identify and describe personal hobbies</objective>
          <objective>Use present simple for habits and routines</objective>
          <objective>Express preferences and opinions</objective>
        </learning_objectives>
        <estimated_duration>450</estimated_duration> <!-- minutes -->
      </metadata>
      
      <vocabulary_bank>
        <vocabulary_item id="hobby" frequency="high" cefr="A1">
          <word>hobby</word>
          <pronunciation>/ËˆhÉ’bi/</pronunciation>
          <audio_files>
            <audio accent="british" file="hobby_uk.mp3"/>
            <audio accent="american" file="hobby_us.mp3"/>
          </audio_files>
          <definition>an activity that you do for pleasure when you are not working</definition>
          <translation lang="vi">sá»Ÿ thÃ­ch</translation>
          <examples>
            <example>My hobby is reading books.</example>
            <example>Building dollhouses is her favorite hobby.</example>
          </examples>
          <collocations>
            <collocation>take up a hobby</collocation>
            <collocation>pursue a hobby</collocation>
          </collocations>
        </vocabulary_item>
        <!-- More vocabulary items... -->
      </vocabulary_bank>
      
      <sections>
        <section id="getting-started" title="Getting Started" order="1">
          <dialogue id="dialogue-01">
            <metadata>
              <context>Two friends discussing their hobbies at home</context>
              <characters>
                <character name="Ann" role="visitor"/>
                <character name="Trang" role="host"/>
              </characters>
            </metadata>
            <exchanges>
              <exchange speaker="Ann">
                <text>Your house is very nice, Trang.</text>
                <translation>NhÃ  cá»§a báº¡n ráº¥t Ä‘áº¹p, Trang.</translation>
                <vocabulary_refs>
                  <ref id="house"/>
                  <ref id="nice"/>
                </vocabulary_refs>
              </exchange>
              <exchange speaker="Trang">
                <text>Thanks! Let's go upstairs. I'll show you my room.</text>
                <translation>Cáº£m Æ¡n! HÃ£y Ä‘i lÃªn láº§u. MÃ¬nh sáº½ cho báº¡n xem phÃ²ng cá»§a mÃ¬nh.</translation>
                <vocabulary_refs>
                  <ref id="upstairs"/>
                  <ref id="show"/>
                  <ref id="room"/>
                </vocabulary_refs>
              </exchange>
              <!-- More exchanges... -->
            </exchanges>
          </dialogue>
          
          <exercises>
            <exercise id="comprehension-01" type="multiple_choice" difficulty="1">
              <question>
                <text>What are Trang and Ann talking about?</text>
                <translation>Trang vÃ  Ann Ä‘ang nÃ³i vá» Ä‘iá»u gÃ¬?</translation>
              </question>
              <options>
                <option id="a" correct="true">Hobbies</option>
                <option id="b">School subjects</option>
                <option id="c">Leisure time</option>
              </options>
              <feedback>
                <correct>Excellent! The conversation focuses on their hobbies and interests.</correct>
                <incorrect>Review the dialogue again. Pay attention to what they discuss about their activities.</incorrect>
              </feedback>
              <vocabulary_focus>
                <ref id="hobby"/>
                <ref id="dollhouse"/>
                <ref id="horse_riding"/>
              </vocabulary_focus>
            </exercise>
            
            <exercise id="vocabulary-matching-01" type="vocabulary_matching" difficulty="2">
              <question>
                <text>Match the vocabulary words with their meanings</text>
                <translation>Ná»‘i cÃ¡c tá»« vá»±ng vá»›i Ã½ nghÄ©a cá»§a chÃºng</translation>
              </question>
              <word_pairs>
                <pair>
                  <word ref_id="creativity"/>
                  <definition>the ability to produce original ideas</definition>
                </pair>
                <pair>
                  <word ref_id="unusual"/>
                  <definition>not common or ordinary</definition>
                </pair>
                <!-- More pairs... -->
              </word_pairs>
              <feedback>
                <general>Practice these vocabulary words by using them in sentences.</general>
              </feedback>
            </exercise>
            
            <exercise id="fill-blanks-01" type="fill_in_blanks" difficulty="2">
              <question>
                <text>Complete the sentences with the correct words</text>
                <translation>HoÃ n thÃ nh cÃ¢u vá»›i nhá»¯ng tá»« Ä‘Ãºng</translation>
              </question>
              <sentences>
                <sentence>
                  <text>My _______ is building dollhouses.</text>
                  <translation>Sá»Ÿ thÃ­ch cá»§a tÃ´i lÃ  xÃ¢y dá»±ng nhÃ  bÃºp bÃª.</translation>
                  <blank position="1" answer="hobby" alternatives="hobbies"/>
                  <vocabulary_refs>
                    <ref id="hobby"/>
                    <ref id="build"/>
                    <ref id="dollhouse"/>
                  </vocabulary_refs>
                </sentence>
                <!-- More sentences... -->
              </sentences>
              <word_bank>
                <word>hobby</word>
                <word>creativity</word>
                <word>unusual</word>
                <word>common</word>
              </word_bank>
            </exercise>
          </exercises>
        </section>
        
        <section id="a-closer-look-1" title="A Closer Look 1" order="2">
          <grammar_focus>
            <topic id="present-simple-hobbies">Present Simple for Hobbies and Routines</topic>
            <explanation>
              <text>We use the present simple to talk about habits, routines, and things that are generally true.</text>
              <translation>ChÃºng ta sá»­ dá»¥ng thÃ¬ hiá»‡n táº¡i Ä‘Æ¡n Ä‘á»ƒ nÃ³i vá» thÃ³i quen, hoáº¡t Ä‘á»™ng hÃ ng ngÃ y vÃ  nhá»¯ng Ä‘iá»u thÆ°á»ng Ä‘Ãºng.</translation>
            </explanation>
            <rules>
              <rule>
                <pattern>Subject + verb (base form) + object</pattern>
                <examples>
                  <example>I play guitar every day.</example>
                  <example>She collects stamps.</example>
                </examples>
              </rule>
              <rule>
                <pattern>Subject (3rd person singular) + verb + s/es + object</pattern>
                <examples>
                  <example>He plays guitar every day.</example>
                  <example>She collects stamps.</example>
                </examples>
              </rule>
            </rules>
          </grammar_focus>
          <!-- Grammar exercises... -->
        </section>
        <!-- More sections... -->
      </sections>
      
      <assessments>
        <assessment id="unit-test-01" type="unit_test">
          <metadata>
            <title>Unit 1 Assessment: Hobbies</title>
            <duration>30</duration>
            <total_points>100</total_points>
          </metadata>
          <test_sections>
            <test_section id="listening" points="25">
              <!-- Listening exercises -->
            </test_section>
            <test_section id="vocabulary" points="30">
              <!-- Vocabulary exercises -->
            </test_section>
            <test_section id="grammar" points="25">
              <!-- Grammar exercises -->
            </test_section>
            <test_section id="writing" points="20">
              <!-- Writing exercises -->
            </test_section>
          </test_sections>
        </assessment>
      </assessments>
    </unit>
  </grade>
</curriculum>
```

### AI Service Integration - Check Before Process

#### Intelligent Content Processing Workflow
The V2 system implements smart content processing that **checks disk first** before using AI:

```typescript
// Main workflow - checks disk, processes only if needed
const result = await contentProcessor.processContent(sourceContent, {
  grade: 7,
  unitId: 'unit-01',
  source: 'loigiahay'
});

// Processing Logic:
// 1. âœ… Check disk: Does /data/structured/grade-7/unit-01.xml exist?
// 2. ğŸ”„ If exists: Compare content hash - changed?
// 3. ğŸ’¾ If unchanged: Load from disk (instant)
// 4. ğŸ¤– If changed/missing: Process with AI
// 5. ğŸ’¿ Save to disk for future instant access
```

#### AI Vocabulary Processor
```typescript
class AIVocabularyProcessor {
  // Check-before-process logic
  async processContent(sourceContent: string, metadata: ContentMetadata): Promise<ProcessingResult>
  
  // Vocabulary-only extraction (doesn't recreate existing content)
  private async extractVocabularyWithAI(content: string): Promise<VocabularyItem[]>
  
  // Hash-based change detection
  async hasSourceContentChanged(grade: number, unitId: string, content: string): Promise<boolean>
}
```

#### Teacher Usage Flow
1. **First Time**: Teacher pastes loigiahay content â†’ AI processes (2 minutes) â†’ Saves to disk
2. **Every Time After**: Content loads instantly from disk (0 seconds)
3. **Content Updates**: AI detects changes via hash comparison â†’ Reprocesses only if needed

#### Content Sources Supported
- **Loigiahay**: Raw web content extraction
- **Manual Notes**: Your personal teaching notes
- **Textbook Content**: Digital textbook materials

The system focuses on **vocabulary extraction only** - preserving your existing exercise and dialogue structure while adding structured vocabulary data.

### Implementation Phases

#### Phase 1: Foundation Setup (Week 1)
- [ ] Project initialization with Vite + TypeScript
- [ ] Base component architecture
- [ ] CSS design system setup
- [ ] Basic routing and navigation

#### Phase 2: Core Components (Week 2)
- [ ] MarkdownViewer component
- [ ] VocabularyCard component
- [ ] AudioPlayer integration
- [ ] Basic content loading

#### Phase 3: Content Structure (Week 3)
- [ ] XML schema finalization
- [ ] Content conversion tools
- [ ] Sample XML data creation
- [ ] Content validation system

#### Phase 4: Interactive Features (Week 4)
- [ ] Quiz generation system
- [ ] Vocabulary selection interface
- [ ] Progress tracking
- [ ] Recent lessons feature

#### Phase 5: AI Integration (Week 5)
- [ ] AI service setup (Claude/Gemini)
- [ ] Automated content processing
- [ ] Bulk content migration tools
- [ ] Quality assurance system

#### Phase 6: Polish & Optimization (Week 6)
- [ ] Mobile responsive design
- [ ] Performance optimization
- [ ] User experience testing
- [ ] Documentation completion

### Performance Targets
- **Bundle Size**: < 200KB gzipped
- **First Contentful Paint**: < 1.5s
- **Time to Interactive**: < 3s
- **Audio Response**: < 500ms
- **Content Loading**: < 2s

### Browser Support
- Chrome/Edge 88+
- Firefox 85+
- Safari 14+
- Mobile browsers with Web Audio API support

### Future Enhancements (V2.1+)
- Progressive Web App (PWA) capabilities
- Offline content synchronization
- Advanced analytics and progress tracking
- Collaborative features for classrooms
- Enhanced gamification elements
- Integration with external LMS systems

## Conclusion

This V2 architecture provides a clean, maintainable, and performant solution for English learning content delivery. The framework-less approach ensures longevity and reduces complexity while the structured XML format enables rich educational experiences. The phased implementation approach allows for iterative development and testing to ensure high-quality delivery.

The system is designed to be extensible and can easily accommodate future requirements while maintaining the core simplicity that makes it valuable for both students and educators.