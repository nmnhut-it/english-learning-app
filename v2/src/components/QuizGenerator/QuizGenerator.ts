import { Component } from '@components/core/Component';\nimport { audioService } from '@services/AudioService';\nimport type { \n  QuizGeneratorProps, \n  Exercise, \n  ExerciseType, \n  ExerciseResult, \n  QuizResults,\n  MultipleChoiceExercise,\n  FillInBlanksExercise,\n  VocabularyMatchingExercise\n} from '@/types';\n\n/**\n * QuizGenerator Component\n * Renders different exercise types and manages quiz flow\n */\nexport class QuizGenerator extends Component<QuizGeneratorProps> {\n  private currentExerciseIndex = 0;\n  private exerciseResults: ExerciseResult[] = [];\n  private startTime = Date.now();\n  private currentExerciseStartTime = Date.now();\n  private isSubmitted = false;\n  private timer: NodeJS.Timeout | null = null;\n  private remainingTime = 0;\n\n  constructor(props: QuizGeneratorProps) {\n    super(props);\n    this.remainingTime = (props.timeLimit || 0) * 60 * 1000; // Convert minutes to milliseconds\n  }\n\n  protected createElement(): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'quiz-generator';\n    \n    const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n    \n    container.innerHTML = `\n      <div class=\"quiz-generator__header\">\n        <div class=\"quiz-progress\">\n          <div class=\"quiz-progress__info\">\n            <span class=\"current-question\">${this.currentExerciseIndex + 1}</span>\n            <span class=\"question-separator\">of</span>\n            <span class=\"total-questions\">${exercises.length}</span>\n          </div>\n          <div class=\"quiz-progress__bar\">\n            <div class=\"quiz-progress__fill\" style=\"width: ${((this.currentExerciseIndex + 1) / exercises.length) * 100}%\"></div>\n          </div>\n        </div>\n        \n        ${this.props.timeLimit ? `\n          <div class=\"quiz-timer\">\n            <span class=\"timer-icon\">‚è±Ô∏è</span>\n            <span class=\"timer-display\">--:--</span>\n          </div>\n        ` : ''}\n      </div>\n      \n      <div class=\"quiz-generator__content\">\n        <div class=\"exercise-container\">\n          <!-- Exercise will be rendered here -->\n        </div>\n      </div>\n      \n      <div class=\"quiz-generator__controls\">\n        <button class=\"quiz-btn quiz-btn--secondary prev-btn\" \n                ${this.currentExerciseIndex === 0 ? 'disabled' : ''}\n                type=\"button\">\n          ‚Üê Previous\n        </button>\n        \n        <div class=\"quiz-controls-center\">\n          <button class=\"quiz-btn quiz-btn--outline hint-btn\" type=\"button\">\n            üí° Hint\n          </button>\n          <button class=\"quiz-btn quiz-btn--outline skip-btn\" type=\"button\">\n            Skip\n          </button>\n        </div>\n        \n        <button class=\"quiz-btn quiz-btn--primary next-btn\" type=\"button\">\n          ${this.currentExerciseIndex === exercises.length - 1 ? 'Submit Quiz' : 'Next ‚Üí'}\n        </button>\n      </div>\n    `;\n\n    this.renderCurrentExercise();\n    this.startTimer();\n    \n    return container;\n  }\n\n  protected bindEvents(): void {\n    const prevBtn = this.querySelector('.prev-btn');\n    const nextBtn = this.querySelector('.next-btn');\n    const hintBtn = this.querySelector('.hint-btn');\n    const skipBtn = this.querySelector('.skip-btn');\n\n    // Navigation controls\n    prevBtn?.addEventListener('click', () => this.previousExercise());\n    nextBtn?.addEventListener('click', () => this.nextExercise());\n    hintBtn?.addEventListener('click', () => this.showHint());\n    skipBtn?.addEventListener('click', () => this.skipExercise());\n\n    // Keyboard shortcuts\n    this.addEventListener('keydown', (e) => {\n      if (e.ctrlKey || e.metaKey) {\n        switch (e.key) {\n          case 'ArrowLeft':\n            e.preventDefault();\n            this.previousExercise();\n            break;\n          case 'ArrowRight':\n            e.preventDefault();\n            this.nextExercise();\n            break;\n          case 'h':\n            e.preventDefault();\n            this.showHint();\n            break;\n          case 's':\n            e.preventDefault();\n            this.skipExercise();\n            break;\n        }\n      }\n    });\n\n    // Auto-save progress\n    setInterval(() => {\n      this.saveProgress();\n    }, 30000); // Save every 30 seconds\n  }\n\n  /**\n   * Render the current exercise based on its type\n   */\n  private renderCurrentExercise(): void {\n    const container = this.querySelector('.exercise-container');\n    if (!container) return;\n\n    const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n    const exercise = exercises[this.currentExerciseIndex];\n    \n    if (!exercise) return;\n\n    this.currentExerciseStartTime = Date.now();\n\n    // Clear previous exercise\n    container.innerHTML = '';\n\n    // Render based on exercise type\n    switch (exercise.type) {\n      case ExerciseType.MULTIPLE_CHOICE:\n        this.renderMultipleChoice(container, exercise as MultipleChoiceExercise);\n        break;\n      case ExerciseType.FILL_IN_BLANKS:\n        this.renderFillInBlanks(container, exercise as FillInBlanksExercise);\n        break;\n      case ExerciseType.VOCABULARY_MATCHING:\n        this.renderVocabularyMatching(container, exercise as VocabularyMatchingExercise);\n        break;\n      case ExerciseType.TRUE_FALSE:\n        this.renderTrueFalse(container, exercise);\n        break;\n      case ExerciseType.LISTENING_COMPREHENSION:\n        this.renderListeningComprehension(container, exercise);\n        break;\n      default:\n        this.renderGenericExercise(container, exercise);\n    }\n\n    // Update progress bar\n    this.updateProgressBar();\n  }\n\n  /**\n   * Render Multiple Choice exercise\n   */\n  private renderMultipleChoice(container: Element, exercise: MultipleChoiceExercise): void {\n    container.innerHTML = `\n      <div class=\"exercise exercise--multiple-choice\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">Multiple Choice</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n            <span class=\"exercise__points\">${exercise.points} points</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__instructions\">\n          <p class=\"instructions-text\">${exercise.metadata.instructions.text}</p>\n          <p class=\"instructions-translation\">${exercise.metadata.instructions.translation}</p>\n        </div>\n        \n        <div class=\"exercise__question\">\n          <h3 class=\"question-text\">${exercise.question.text}</h3>\n          <p class=\"question-translation\">${exercise.question.translation}</p>\n          ${exercise.question.audio_cue ? `\n            <button class=\"audio-cue-btn\" data-audio=\"${exercise.question.audio_cue}\" type=\"button\">\n              üîä Listen\n            </button>\n          ` : ''}\n        </div>\n        \n        <div class=\"exercise__options\">\n          ${exercise.options.map((option, index) => `\n            <label class=\"option-label\" for=\"option-${option.id}\">\n              <input type=\"radio\" \n                     id=\"option-${option.id}\" \n                     name=\"exercise-${exercise.id}\" \n                     value=\"${option.id}\"\n                     class=\"option-input\">\n              <span class=\"option-content\">\n                <span class=\"option-letter\">${String.fromCharCode(65 + index)}</span>\n                <span class=\"option-text\">${option.text}</span>\n                ${option.translation ? `<span class=\"option-translation\">${option.translation}</span>` : ''}\n              </span>\n            </label>\n          `).join('')}\n        </div>\n        \n        <div class=\"exercise__feedback\" style=\"display: none;\"></div>\n      </div>\n    `;\n\n    // Bind audio cue button\n    const audioCueBtn = container.querySelector('.audio-cue-btn');\n    if (audioCueBtn) {\n      audioCueBtn.addEventListener('click', async () => {\n        const audioUrl = audioCueBtn.getAttribute('data-audio');\n        if (audioUrl) {\n          try {\n            await audioService.playAudio(audioUrl);\n          } catch (error) {\n            console.error('Failed to play audio cue:', error);\n          }\n        }\n      });\n    }\n\n    // Bind option selection\n    const options = container.querySelectorAll('.option-input');\n    options.forEach(option => {\n      option.addEventListener('change', () => {\n        this.enableNextButton();\n      });\n    });\n  }\n\n  /**\n   * Render Fill in the Blanks exercise\n   */\n  private renderFillInBlanks(container: Element, exercise: FillInBlanksExercise): void {\n    container.innerHTML = `\n      <div class=\"exercise exercise--fill-blanks\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">Fill in the Blanks</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n            <span class=\"exercise__points\">${exercise.points} points</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__instructions\">\n          <p class=\"instructions-text\">${exercise.metadata.instructions.text}</p>\n          <p class=\"instructions-translation\">${exercise.metadata.instructions.translation}</p>\n        </div>\n        \n        <div class=\"exercise__content\">\n          <div class=\"sentences-container\">\n            ${exercise.content.sentences.map((sentence, sentenceIndex) => {\n              let processedText = sentence.text;\n              sentence.blanks.forEach((blank, blankIndex) => {\n                const placeholder = `<input type=\"text\" \n                                            class=\"blank-input\" \n                                            data-sentence=\"${sentenceIndex}\" \n                                            data-blank=\"${blankIndex}\" \n                                            placeholder=\"___\" \n                                            autocomplete=\"off\">`;\n                processedText = processedText.replace('_'.repeat(6), placeholder);\n              });\n              \n              return `\n                <div class=\"sentence-item\">\n                  <div class=\"sentence-text\">${processedText}</div>\n                  <div class=\"sentence-translation\">${sentence.translation}</div>\n                </div>\n              `;\n            }).join('')}\n          </div>\n          \n          ${exercise.content.word_bank ? `\n            <div class=\"word-bank\">\n              <h4 class=\"word-bank__title\">Word Bank:</h4>\n              <div class=\"word-bank__words\">\n                ${exercise.content.word_bank.words.map(word => `\n                  <span class=\"word-bank__item\" data-word=\"${word}\">${word}</span>\n                `).join('')}\n              </div>\n            </div>\n          ` : ''}\n        </div>\n        \n        <div class=\"exercise__feedback\" style=\"display: none;\"></div>\n      </div>\n    `;\n\n    // Bind word bank interactions\n    const wordBankItems = container.querySelectorAll('.word-bank__item');\n    const blankInputs = container.querySelectorAll('.blank-input');\n    \n    wordBankItems.forEach(item => {\n      item.addEventListener('click', () => {\n        const word = item.getAttribute('data-word');\n        const activeInput = container.querySelector('.blank-input:focus') as HTMLInputElement;\n        if (activeInput && word) {\n          activeInput.value = word;\n          item.classList.add('used');\n          this.checkAllBlanksCompleted();\n        }\n      });\n    });\n\n    // Auto-complete and validation\n    blankInputs.forEach(input => {\n      input.addEventListener('input', () => {\n        this.checkAllBlanksCompleted();\n      });\n      \n      input.addEventListener('keydown', (e) => {\n        if (e.key === 'Tab') {\n          const nextInput = this.getNextBlankInput(input as HTMLInputElement);\n          if (nextInput) {\n            e.preventDefault();\n            nextInput.focus();\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Render Vocabulary Matching exercise\n   */\n  private renderVocabularyMatching(container: Element, exercise: VocabularyMatchingExercise): void {\n    const shuffledPairs = this.shuffleArray([...exercise.word_pairs]);\n    const words = shuffledPairs.map(pair => ({ id: pair.id, text: pair.word.id, type: 'word' }));\n    const definitions = this.shuffleArray(shuffledPairs.map(pair => ({ \n      id: pair.id, \n      text: pair.definition, \n      type: 'definition' \n    })));\n\n    container.innerHTML = `\n      <div class=\"exercise exercise--vocabulary-matching\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">Vocabulary Matching</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n            <span class=\"exercise__points\">${exercise.points} points</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__instructions\">\n          <p class=\"instructions-text\">${exercise.metadata.instructions.text}</p>\n          <p class=\"instructions-translation\">${exercise.metadata.instructions.translation}</p>\n        </div>\n        \n        <div class=\"exercise__content\">\n          <div class=\"matching-container\">\n            <div class=\"matching-column matching-column--words\">\n              <h4 class=\"column-title\">Words</h4>\n              <div class=\"matching-items\">\n                ${words.map(word => `\n                  <div class=\"matching-item matching-item--word\" \n                       data-id=\"${word.id}\" \n                       data-type=\"${word.type}\">\n                    ${word.text}\n                  </div>\n                `).join('')}\n              </div>\n            </div>\n            \n            <div class=\"matching-column matching-column--definitions\">\n              <h4 class=\"column-title\">Definitions</h4>\n              <div class=\"matching-items\">\n                ${definitions.map(def => `\n                  <div class=\"matching-item matching-item--definition\" \n                       data-id=\"${def.id}\" \n                       data-type=\"${def.type}\">\n                    ${def.text}\n                  </div>\n                `).join('')}\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"matches-display\">\n            <h4>Your Matches:</h4>\n            <div class=\"matches-list\"></div>\n          </div>\n        </div>\n        \n        <div class=\"exercise__feedback\" style=\"display: none;\"></div>\n      </div>\n    `;\n\n    this.setupMatchingInteractions(container);\n  }\n\n  /**\n   * Render True/False exercise\n   */\n  private renderTrueFalse(container: Element, exercise: Exercise): void {\n    container.innerHTML = `\n      <div class=\"exercise exercise--true-false\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">True/False</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n            <span class=\"exercise__points\">${exercise.points} points</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__instructions\">\n          <p class=\"instructions-text\">${exercise.metadata.instructions.text}</p>\n          <p class=\"instructions-translation\">${exercise.metadata.instructions.translation}</p>\n        </div>\n        \n        <div class=\"exercise__question\">\n          <h3 class=\"question-text\">${exercise.question.text}</h3>\n          <p class=\"question-translation\">${exercise.question.translation}</p>\n        </div>\n        \n        <div class=\"exercise__options\">\n          <label class=\"option-label option-label--true\">\n            <input type=\"radio\" name=\"tf-${exercise.id}\" value=\"true\" class=\"option-input\">\n            <span class=\"option-content\">\n              <span class=\"option-icon\">‚úì</span>\n              <span class=\"option-text\">True</span>\n            </span>\n          </label>\n          \n          <label class=\"option-label option-label--false\">\n            <input type=\"radio\" name=\"tf-${exercise.id}\" value=\"false\" class=\"option-input\">\n            <span class=\"option-content\">\n              <span class=\"option-icon\">‚úó</span>\n              <span class=\"option-text\">False</span>\n            </span>\n          </label>\n        </div>\n        \n        <div class=\"exercise__feedback\" style=\"display: none;\"></div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render Listening Comprehension exercise\n   */\n  private renderListeningComprehension(container: Element, exercise: Exercise): void {\n    container.innerHTML = `\n      <div class=\"exercise exercise--listening\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">Listening</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n            <span class=\"exercise__points\">${exercise.points} points</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__instructions\">\n          <p class=\"instructions-text\">${exercise.metadata.instructions.text}</p>\n          <p class=\"instructions-translation\">${exercise.metadata.instructions.translation}</p>\n        </div>\n        \n        <div class=\"exercise__audio\">\n          <div class=\"audio-player\">\n            <button class=\"audio-play-btn\" type=\"button\">\n              <span class=\"play-icon\">‚ñ∂Ô∏è</span>\n              <span class=\"play-text\">Play Audio</span>\n            </button>\n            <div class=\"audio-controls\">\n              <span class=\"audio-duration\">0:00</span>\n              <button class=\"audio-repeat-btn\" type=\"button\">üîÑ Repeat</button>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"exercise__question\">\n          <h3 class=\"question-text\">${exercise.question.text}</h3>\n          <p class=\"question-translation\">${exercise.question.translation}</p>\n        </div>\n        \n        <div class=\"exercise__answer\">\n          <textarea class=\"answer-input\" \n                   placeholder=\"Type your answer here...\" \n                   rows=\"4\"></textarea>\n        </div>\n        \n        <div class=\"exercise__feedback\" style=\"display: none;\"></div>\n      </div>\n    `;\n  }\n\n  /**\n   * Generic exercise renderer for unsupported types\n   */\n  private renderGenericExercise(container: Element, exercise: Exercise): void {\n    container.innerHTML = `\n      <div class=\"exercise exercise--generic\" data-exercise-id=\"${exercise.id}\">\n        <div class=\"exercise__header\">\n          <h2 class=\"exercise__title\">${exercise.metadata.title}</h2>\n          <div class=\"exercise__meta\">\n            <span class=\"exercise__type\">${exercise.type}</span>\n            <span class=\"exercise__difficulty\">Level ${exercise.difficulty}</span>\n          </div>\n        </div>\n        \n        <div class=\"exercise__content\">\n          <p>This exercise type (${exercise.type}) is not yet implemented.</p>\n          <p>Please skip this exercise or contact support.</p>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Navigation methods\n   */\n  private async nextExercise(): Promise<void> {\n    const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n    const isLastExercise = this.currentExerciseIndex >= exercises.length - 1;\n\n    if (isLastExercise) {\n      await this.submitQuiz();\n    } else {\n      // Record current exercise result\n      this.recordCurrentExerciseResult();\n      \n      // Move to next exercise\n      this.currentExerciseIndex++;\n      this.renderCurrentExercise();\n      this.updateNavigationButtons();\n      \n      // Scroll to top\n      this.element.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  }\n\n  private previousExercise(): void {\n    if (this.currentExerciseIndex > 0) {\n      this.recordCurrentExerciseResult();\n      this.currentExerciseIndex--;\n      this.renderCurrentExercise();\n      this.updateNavigationButtons();\n      this.element.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  }\n\n  private showHint(): void {\n    // Implementation for showing hints\n    const exercise = this.props.exercises[this.currentExerciseIndex];\n    if (exercise) {\n      // Show hint modal or inline hint\n      this.displayHint(exercise);\n    }\n  }\n\n  private skipExercise(): void {\n    this.recordCurrentExerciseResult(true);\n    this.nextExercise();\n  }\n\n  /**\n   * Quiz submission and results\n   */\n  private async submitQuiz(): Promise<void> {\n    if (this.isSubmitted) return;\n    \n    this.isSubmitted = true;\n    this.recordCurrentExerciseResult();\n    this.stopTimer();\n    \n    const totalTime = Date.now() - this.startTime;\n    const results = this.calculateResults(totalTime);\n    \n    // Save final results\n    this.saveResults(results);\n    \n    // Call completion callback\n    this.props.onQuizComplete?.(results);\n    \n    // Emit completion event\n    this.eventBus.emit('quiz-complete', results);\n  }\n\n  /**\n   * Utility methods\n   */\n  private recordCurrentExerciseResult(skipped = false): void {\n    const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n    const exercise = exercises[this.currentExerciseIndex];\n    \n    if (!exercise) return;\n\n    const timeSpent = Date.now() - this.currentExerciseStartTime;\n    const userAnswer = this.getUserAnswer(exercise);\n    const correctAnswer = this.getCorrectAnswer(exercise);\n    const isCorrect = !skipped && this.isAnswerCorrect(userAnswer, correctAnswer, exercise);\n\n    const result: ExerciseResult = {\n      exerciseId: exercise.id,\n      correct: isCorrect,\n      userAnswer,\n      correctAnswer,\n      timeSpent,\n      hintsUsed: 0 // Would track this in implementation\n    };\n\n    // Update existing result or add new one\n    const existingIndex = this.exerciseResults.findIndex(r => r.exerciseId === exercise.id);\n    if (existingIndex >= 0) {\n      this.exerciseResults[existingIndex] = result;\n    } else {\n      this.exerciseResults.push(result);\n    }\n  }\n\n  private calculateResults(totalTime: number): QuizResults {\n    const correctAnswers = this.exerciseResults.filter(r => r.correct).length;\n    const totalQuestions = this.exerciseResults.length;\n    const maxScore = this.props.exercises.reduce((sum, ex) => sum + (ex.points || 10), 0);\n    const score = this.exerciseResults.reduce((sum, result) => {\n      const exercise = this.props.exercises.find(ex => ex.id === result.exerciseId);\n      return sum + (result.correct ? (exercise?.points || 10) : 0);\n    }, 0);\n\n    return {\n      score,\n      maxScore,\n      percentage: totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0,\n      timeSpent: totalTime,\n      correctAnswers,\n      totalQuestions,\n      exerciseResults: this.exerciseResults\n    };\n  }\n\n  private updateProgressBar(): void {\n    const progressFill = this.querySelector('.quiz-progress__fill');\n    const currentQuestion = this.querySelector('.current-question');\n    \n    if (progressFill && currentQuestion) {\n      const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n      const progress = ((this.currentExerciseIndex + 1) / exercises.length) * 100;\n      \n      progressFill.style.width = `${progress}%`;\n      currentQuestion.textContent = (this.currentExerciseIndex + 1).toString();\n    }\n  }\n\n  private updateNavigationButtons(): void {\n    const prevBtn = this.querySelector('.prev-btn') as HTMLButtonElement;\n    const nextBtn = this.querySelector('.next-btn') as HTMLButtonElement;\n    \n    if (prevBtn) {\n      prevBtn.disabled = this.currentExerciseIndex === 0;\n    }\n    \n    if (nextBtn) {\n      const exercises = this.props.exercises.slice(0, this.props.maxQuestions || this.props.exercises.length);\n      const isLastExercise = this.currentExerciseIndex >= exercises.length - 1;\n      nextBtn.textContent = isLastExercise ? 'Submit Quiz' : 'Next ‚Üí';\n    }\n  }\n\n  private startTimer(): void {\n    if (!this.props.timeLimit) return;\n    \n    this.timer = setInterval(() => {\n      this.remainingTime -= 1000;\n      this.updateTimerDisplay();\n      \n      if (this.remainingTime <= 0) {\n        this.submitQuiz();\n      }\n    }, 1000);\n    \n    this.updateTimerDisplay();\n  }\n\n  private stopTimer(): void {\n    if (this.timer) {\n      clearInterval(this.timer);\n      this.timer = null;\n    }\n  }\n\n  private updateTimerDisplay(): void {\n    const timerDisplay = this.querySelector('.timer-display');\n    if (timerDisplay && this.props.timeLimit) {\n      const minutes = Math.floor(this.remainingTime / 60000);\n      const seconds = Math.floor((this.remainingTime % 60000) / 1000);\n      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n      \n      // Warning styles\n      if (this.remainingTime < 60000) { // Less than 1 minute\n        timerDisplay.classList.add('timer--warning');\n      }\n      if (this.remainingTime < 30000) { // Less than 30 seconds\n        timerDisplay.classList.add('timer--danger');\n      }\n    }\n  }\n\n  // Helper methods for specific exercise types\n  private setupMatchingInteractions(container: Element): void {\n    // Implementation for drag-and-drop or click-to-match functionality\n    // This would be a complex implementation with touch/mouse event handling\n  }\n\n  private getUserAnswer(exercise: Exercise): string | string[] {\n    // Implementation to extract user's answer based on exercise type\n    return '';\n  }\n\n  private getCorrectAnswer(exercise: Exercise): string | string[] {\n    // Implementation to get correct answer based on exercise type\n    return '';\n  }\n\n  private isAnswerCorrect(userAnswer: string | string[], correctAnswer: string | string[], exercise: Exercise): boolean {\n    // Implementation for answer validation\n    return false;\n  }\n\n  private shuffleArray<T>(array: T[]): T[] {\n    const shuffled = [...array];\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    return shuffled;\n  }\n\n  private enableNextButton(): void {\n    const nextBtn = this.querySelector('.next-btn') as HTMLButtonElement;\n    if (nextBtn) {\n      nextBtn.disabled = false;\n    }\n  }\n\n  private checkAllBlanksCompleted(): void {\n    const blankInputs = this.querySelectorAll('.blank-input') as NodeListOf<HTMLInputElement>;\n    const allFilled = Array.from(blankInputs).every(input => input.value.trim() !== '');\n    \n    if (allFilled) {\n      this.enableNextButton();\n    }\n  }\n\n  private getNextBlankInput(currentInput: HTMLInputElement): HTMLInputElement | null {\n    const allInputs = Array.from(this.querySelectorAll('.blank-input')) as HTMLInputElement[];\n    const currentIndex = allInputs.indexOf(currentInput);\n    return allInputs[currentIndex + 1] || null;\n  }\n\n  private displayHint(exercise: Exercise): void {\n    // Implementation for displaying hints\n  }\n\n  private saveProgress(): void {\n    // Implementation for saving progress to localStorage\n  }\n\n  private saveResults(results: QuizResults): void {\n    // Implementation for saving final results\n  }\n\n  /**\n   * Cleanup on destroy\n   */\n  protected onDestroy(): void {\n    this.stopTimer();\n    audioService.stopPlayback();\n  }\n}"