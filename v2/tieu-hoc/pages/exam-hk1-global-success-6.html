<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√în t·∫≠p Ki·ªÉm tra cu·ªëi HK1 - Ti·∫øng Anh 6 Global Success | English Grammar Games</title>
  <meta name="description" content="√în t·∫≠p ƒë·ªÅ thi cu·ªëi h·ªçc k√¨ 1 Ti·∫øng Anh 6 - Global Success v·ªõi gi·∫£i th√≠ch chi ti·∫øt">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">

  <!-- Listening Exercise Styles -->
  <style>
    /* Listening Exercise Styles */
    .listening-exercise__header {
      margin-bottom: var(--spacing-md);
    }

    .listening-exercise__instruction {
      color: var(--text-light);
      font-size: var(--font-size-sm);
      margin-top: var(--spacing-xs);
    }

    .listening-exercise__audio {
      background: var(--bg-light);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
    }

    .listening-exercise__audio-title {
      font-size: var(--font-size-md);
      margin-bottom: var(--spacing-sm);
      color: var(--primary);
    }

    .listening-exercise__player {
      width: 100%;
      margin-bottom: var(--spacing-sm);
    }

    .listening-exercise__source {
      font-size: var(--font-size-sm);
      color: var(--text-light);
      font-style: italic;
    }

    .listening-exercise__transcript {
      background: white;
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-top: var(--spacing-sm);
      border: 1px solid var(--border-color);
      font-size: var(--font-size-sm);
      line-height: 1.6;
    }

    .listening-exercise__passage {
      background: white;
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
      border: 1px solid var(--border-color);
      line-height: 1.8;
    }

    .listening-exercise__questions {
      margin-bottom: var(--spacing-md);
    }

    .listening-exercise__questions-title {
      font-size: var(--font-size-md);
      margin-bottom: var(--spacing-md);
      color: var(--text-dark);
    }

    .listening-exercise__blanks {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .listening-exercise__actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: center;
      flex-wrap: wrap;
    }

    /* TRUE/FALSE Question Styles */
    .listening-question {
      background: white;
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-sm);
      border: 1px solid var(--border-color);
    }

    .listening-question__text {
      margin-bottom: var(--spacing-sm);
      line-height: 1.5;
    }

    .tf-options {
      display: flex;
      gap: var(--spacing-md);
    }

    .tf-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .tf-option:hover {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.05);
    }

    .tf-option--selected {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.1);
    }

    .tf-option--correct {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.2);
    }

    .tf-option--wrong {
      border-color: var(--danger);
      background: rgba(244, 67, 54, 0.2);
    }

    .tf-input {
      cursor: pointer;
    }

    .listening-question--correct {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.05);
    }

    .listening-question--wrong {
      border-color: var(--danger);
      background: rgba(244, 67, 54, 0.05);
    }

    /* Multiple Choice Question Styles */
    .mc-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .mc-option {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .mc-option:hover {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.05);
    }

    .mc-option--selected {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.1);
    }

    .mc-option--correct {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.2);
    }

    .mc-option--wrong {
      border-color: var(--danger);
      background: rgba(244, 67, 54, 0.2);
    }

    .mc-input {
      cursor: pointer;
    }

    .mc-text {
      flex: 1;
    }

    /* Fill Blank Styles */
    .listening-blank {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      background: white;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
    }

    .listening-blank__label {
      font-weight: bold;
      color: var(--primary);
      min-width: 40px;
    }

    .listening-blank__input {
      flex: 1;
      padding: var(--spacing-sm);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: var(--font-size-base);
    }

    .listening-blank__input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
    }

    .listening-blank__result {
      font-weight: bold;
      min-width: 120px;
    }

    .result--correct {
      color: var(--primary);
    }

    .result--wrong {
      color: var(--danger);
    }

    /* Result Icons */
    .result-icon {
      font-weight: bold;
    }

    .result-icon--correct {
      color: var(--primary);
    }

    .result-icon--wrong {
      color: var(--danger);
    }

    /* Explanation Box */
    .explanation-box {
      display: none;
      margin-top: var(--spacing-sm);
      padding: var(--spacing-sm);
      background: var(--bg-light);
      border-radius: var(--border-radius);
      font-size: var(--font-size-sm);
    }

    .explanation-box.show {
      display: block;
    }

    .explanation-box__title {
      font-weight: bold;
      margin-bottom: var(--spacing-xs);
    }

    .explanation-box__content p {
      margin: var(--spacing-xs) 0;
    }

    /* Multiple Choice for Reading */
    .reading-question__options .choice-item--correct .choice-label {
      border-color: var(--primary);
      background: rgba(76, 175, 80, 0.2);
    }

    .reading-question__options .choice-item--wrong .choice-label {
      border-color: var(--danger);
      background: rgba(244, 67, 54, 0.2);
    }
  </style>
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">√în t·∫≠p Ki·ªÉm tra cu·ªëi HK1 - Ti·∫øng Anh 6</h1>
          <p class="game-header__subtitle">Global Success - NH 2025-2026</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">Gi√°o vi√™n:</span>
              <span class="game-info__value">Nguy·ªÖn Minh Nh·ª±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">H·ªçc sinh:</span>
              <span class="game-info__value">L·ªõp 6</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">ƒêi·ªÉm</span>
            <span class="stat__value stat__value--primary" id="current-score">0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Ti·∫øn ƒë·ªô</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>üìñ Ki·∫øn th·ª©c tr·ªçng t√¢m</span>
        <span class="theory-panel__icon" id="theory-icon">‚ñº</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">C·∫•u tr√∫c ƒë·ªÅ thi HK1 l·ªõp 7</h3>
          <ul>
            <li><strong>Listening:</strong> TRUE/FALSE, Ch·ªçn ƒë√°p √°n ƒë√∫ng</li>
            <li><strong>Reading:</strong> ƒêi·ªÅn t·ª´ v√†o ƒëo·∫°n vƒÉn, ƒê·ªçc hi·ªÉu</li>
            <li><strong>Grammar:</strong> Th√¨ hi·ªán t·∫°i ƒë∆°n, qu√° kh·ª© ƒë∆°n, some/any, so s√°nh</li>
            <li><strong>Writing:</strong> Vi·∫øt l·∫°i c√¢u, Chia ƒë·ªông t·ª´, Vi·∫øt t·ª´ g·ª£i √Ω</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">1. Th√¨ Hi·ªán t·∫°i ƒë∆°n (Present Simple)</h3>
          <div class="theory-panel__example">
            S + V(s/es) + O (kh·∫≥ng ƒë·ªãnh)<br>
            S + do/does + not + V + O (ph·ªß ƒë·ªãnh)<br>
            Do/Does + S + V + O? (nghi v·∫•n)
          </div>
          <ul>
            <li><strong>D·∫•u hi·ªáu:</strong> always, usually, often, sometimes, every day/week/month</li>
            <li><strong>V√≠ d·ª•:</strong> I usually get up late on Sundays.</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">2. Th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn (Present Continuous)</h3>
          <div class="theory-panel__example">
            S + am/is/are + V-ing + O
          </div>
          <ul>
            <li><strong>D·∫•u hi·ªáu:</strong> now, at the moment, at present, Look!, Listen!</li>
            <li><strong>V√≠ d·ª•:</strong> Look! Toby is having some fast food again!</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">3. Th√¨ Qu√° kh·ª© ƒë∆°n (Past Simple)</h3>
          <div class="theory-panel__example">
            S + V-ed/V2 + O (kh·∫≥ng ƒë·ªãnh)<br>
            S + did not + V + O (ph·ªß ƒë·ªãnh)<br>
            Did + S + V + O? (nghi v·∫•n)
          </div>
          <ul>
            <li><strong>D·∫•u hi·ªáu:</strong> yesterday, last week/month/year, ago, in 2020</li>
            <li><strong>V√≠ d·ª•:</strong> He didn't go to school last Monday.</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">4. Some / Any</h3>
          <ul>
            <li><strong>Some:</strong> D√πng trong c√¢u kh·∫≥ng ƒë·ªãnh, c√¢u m·ªùi, c√¢u y√™u c·∫ßu</li>
            <li><strong>Any:</strong> D√πng trong c√¢u ph·ªß ƒë·ªãnh v√† c√¢u h·ªèi</li>
            <li><strong>V√≠ d·ª•:</strong> I don't have any oranges, but I have some apples.</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">5. So s√°nh h∆°n (Comparatives)</h3>
          <ul>
            <li><strong>T√≠nh t·ª´ ng·∫Øn:</strong> S + be + adj-er + than + O</li>
            <li><strong>T√≠nh t·ª´ d√†i:</strong> S + be + more + adj + than + O</li>
            <li><strong>V√≠ d·ª•:</strong> This film is more exciting than the TV show.</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">6. The same as / Different from</h3>
          <ul>
            <li><strong>the same as:</strong> gi·ªëng nh∆∞</li>
            <li><strong>different from:</strong> kh√°c v·ªõi</li>
            <li><strong>not the same as = different from</strong></li>
            <li><strong>V√≠ d·ª•:</strong> The characters in the film are different from the ones in the play.</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">7. Gi·ªõi t·ª´ th·ªùi gian (in, on, at)</h3>
          <ul>
            <li><strong>in:</strong> th√°ng, nƒÉm, m√πa, bu·ªïi (in January, in 2024, in summer, in the morning)</li>
            <li><strong>on:</strong> ng√†y, th·ª©, ng√†y th√°ng (on Monday, on Sunday morning, on July 4th)</li>
            <li><strong>at:</strong> gi·ªù, th·ªùi ƒëi·ªÉm c·ª• th·ªÉ (at 7 o'clock, at noon, at night)</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">8. C·ª•m t·ª´ quan tr·ªçng</h3>
          <ul>
            <li><strong>take part in:</strong> tham gia</li>
            <li><strong>entrance exam:</strong> k·ª≥ thi ƒë·∫ßu v√†o</li>
            <li><strong>everyday life:</strong> cu·ªôc s·ªëng h√†ng ng√†y</li>
            <li><strong>made from:</strong> ƒë∆∞·ª£c l√†m t·ª´ (nguy√™n li·ªáu ƒë√£ bi·∫øn ƒë·ªïi)</li>
            <li><strong>one of the most + adj:</strong> m·ªôt trong nh·ªØng... nh·∫•t</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>ƒêang t·∫£i...</h2>
        <p>Vui l√≤ng ch·ªù trong gi√¢y l√°t.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/sentence-rewrite.js"></script>
  <script src="../js/exercises/sentence-build.js"></script>
  <script src="../js/exercises/reading-comprehension.js"></script>
  <script src="../js/exercises/listening.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'exam-hk1-global-success-6';
    const DATA_PATH = '../data/exam-hk1-global-success-6.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">L·ªói t·∫£i d·ªØ li·ªáu</h2>
            <p>Xin l·ªói, kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu b√†i t·∫≠p. Vui l√≤ng t·∫£i l·∫°i trang.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">L·ªói: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">T·∫£i l·∫°i trang</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
