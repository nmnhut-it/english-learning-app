<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit 12: Famous Inventions - Passive Past Simple | English Grammar Games</title>
  <meta name="description" content="Practice the passive voice in past simple and passive questions">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Unit 12: Famous Inventions</h1>
          <p class="game-header__subtitle">Passive Voice - Past Simple & Questions</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">Gi√°o vi√™n:</span>
              <span class="game-info__value">Nguy·ªÖn Minh Nh·ª±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">H·ªçc sinh:</span>
              <span class="game-info__value"></span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">ƒêi·ªÉm</span>
            <span class="stat__value stat__value--primary" id="current-score">‚≠ê 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Ti·∫øn ƒë·ªô</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>üìñ T√†i li·ªáu ng·ªØ ph√°p</span>
        <span class="theory-panel__icon" id="theory-icon">‚ñº</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">üéØ C√¢u B·ªã ƒê·ªông l√† g√¨?</h3>
          <p>Khi n√≥i v·ªÅ ph√°t minh, kh√°m ph√°, ch√∫ng ta th∆∞·ªùng quan t√¢m ƒë·∫øn <strong>c√°i g√¨ ƒë∆∞·ª£c t·∫°o ra</strong> h∆°n l√† <strong>ai ƒë√£ t·∫°o ra n√≥</strong>. ƒê√≥ l√† l√∫c ta d√πng c√¢u b·ªã ƒë·ªông!</p>

          <div class="theory-panel__example" style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin: 10px 0;">
            <strong>So s√°nh:</strong><br>
            ‚úèÔ∏è Ch·ªß ƒë·ªông (Active): <em>Alexander Graham Bell invented the telephone in 1876.</em><br>
            üì± B·ªã ƒë·ªông (Passive): <em><strong>The telephone was invented</strong> in 1876 (by Alexander Graham Bell).</em><br><br>
            ‚Üí Nh·∫•n m·∫°nh v√†o "ƒëi·ªán tho·∫°i" ch·ª© kh√¥ng ph·∫£i "Bell"
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">üìù C·∫•u Tr√∫c: was/were + V3 (past participle)</h3>

          <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
            <tr style="background: #4CAF50; color: white;">
              <th style="padding: 10px; text-align: left;">Lo·∫°i c√¢u</th>
              <th style="padding: 10px; text-align: left;">C√¥ng th·ª©c</th>
              <th style="padding: 10px; text-align: left;">V√≠ d·ª•</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>Kh·∫≥ng ƒë·ªãnh (+)</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">S + was/were + V3</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The car <strong>was made</strong> in Germany.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>Ph·ªß ƒë·ªãnh (-)</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">S + wasn't/weren't + V3</td>
              <td style="padding: 10px; border: 1px solid #ddd;">It <strong>wasn't built</strong> in France.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>C√¢u h·ªèi (?)</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">Was/Were + S + V3?</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>Was</strong> television <strong>invented</strong> in 1927?</td>
            </tr>
          </table>

          <div class="theory-panel__example" style="background: #fff3e0; padding: 12px; border-radius: 8px; margin-top: 10px;">
            <strong>üí° M·∫πo nh·ªõ V3 (Past Participle):</strong><br>
            ‚Ä¢ invent ‚Üí invent<strong>ed</strong> (c√≥ quy t·∫Øc)<br>
            ‚Ä¢ make ‚Üí ma<strong>de</strong> (b·∫•t quy t·∫Øc)<br>
            ‚Ä¢ fly ‚Üí flo<strong>wn</strong> (b·∫•t quy t·∫Øc)<br>
            ‚Ä¢ build ‚Üí buil<strong>t</strong> (b·∫•t quy t·∫Øc)
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">üîÑ Was hay Were? Ph√¢n bi·ªát d·ªÖ d√†ng!</h3>

          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2196F3; color: white;">
              <th style="padding: 10px; text-align: center;">Ch·ªß ng·ªØ</th>
              <th style="padding: 10px; text-align: center;">D√πng</th>
              <th style="padding: 10px; text-align: left;">V√≠ d·ª•</th>
            </tr>
            <tr>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">
                I / He / She / It<br>
                <small>(s·ªë √≠t)</small>
              </td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-size: 20px;"><strong>was</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">
                The car <strong>was</strong> invented.<br>
                It <strong>was</strong> built in 1886.
              </td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">
                You / We / They<br>
                <small>(s·ªë nhi·ªÅu)</small>
              </td>
              <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-size: 20px;"><strong>were</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">
                The cars <strong>were</strong> made.<br>
                They <strong>were</strong> sold worldwide.
              </td>
            </tr>
          </table>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">‚ùì C√¢u H·ªèi B·ªã ƒê·ªông - H·ªèi nh∆∞ th·∫ø n√†o?</h3>

          <p><strong>1Ô∏è‚É£ Yes/No Questions (C√¢u h·ªèi tr·∫£ l·ªùi C√≥/Kh√¥ng):</strong></p>
          <div class="theory-panel__example">
            ƒê·∫£o <strong>was/were</strong> l√™n tr∆∞·ªõc ch·ªß ng·ªØ:<br>
            ‚úì <strong>Was</strong> television <strong>invented</strong> in 1927? ‚Üí Yes, it was.<br>
            ‚úì <strong>Were</strong> the first cars <strong>made</strong> in the USA? ‚Üí No, they weren't.
          </div>

          <p style="margin-top: 15px;"><strong>2Ô∏è‚É£ WH-Questions (C√¢u h·ªèi c√≥ t·ª´ ƒë·ªÉ h·ªèi):</strong></p>
          <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <tr style="background: #ff9800; color: white;">
              <th style="padding: 8px;">T·ª´ h·ªèi</th>
              <th style="padding: 8px;">C√¥ng th·ª©c</th>
              <th style="padding: 8px;">V√≠ d·ª•</th>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #ddd;"><strong>Who</strong><br><small>(Ai?)</small></td>
              <td style="padding: 8px; border: 1px solid #ddd;">Who + was/were + S + V3 + <strong>by?</strong></td>
              <td style="padding: 8px; border: 1px solid #ddd;">Who was it invented <strong>by?</strong></td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 8px; border: 1px solid #ddd;"><strong>When</strong><br><small>(Khi n√†o?)</small></td>
              <td style="padding: 8px; border: 1px solid #ddd;">When + was/were + S + V3?</td>
              <td style="padding: 8px; border: 1px solid #ddd;">When was the telephone invented?</td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #ddd;"><strong>Where</strong><br><small>(·ªû ƒë√¢u?)</small></td>
              <td style="padding: 8px; border: 1px solid #ddd;">Where + was/were + S + V3?</td>
              <td style="padding: 8px; border: 1px solid #ddd;">Where was the first car made?</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 8px; border: 1px solid #ddd;"><strong>What</strong><br><small>(C√°i g√¨?)</small></td>
              <td style="padding: 8px; border: 1px solid #ddd;">What + was/were + V3...?</td>
              <td style="padding: 8px; border: 1px solid #ddd;">What was invented in 1876?</td>
            </tr>
          </table>

          <div class="theory-panel__example" style="background: #ffebee; padding: 12px; border-radius: 8px; margin-top: 10px;">
            <strong>‚ö†Ô∏è Ch√∫ √Ω:</strong> V·ªõi c√¢u h·ªèi <strong>"Who"</strong>, nh·ªõ th√™m <strong>"by"</strong> ·ªü cu·ªëi c√¢u!<br>
            ‚ùå Who was the film directed? (Sai)<br>
            ‚úÖ Who was the film directed <strong>by</strong>? (ƒê√∫ng)
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">‚ö†Ô∏è Nh·ªØng L·ªói Th∆∞·ªùng G·∫∑p - Tr√°nh ngay!</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #f44336; color: white;">
              <th style="padding: 10px; width: 50%;">‚ùå SAI</th>
              <th style="padding: 10px; width: 50%;">‚úÖ ƒê√öNG</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;">was <strong>invent</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">was <strong>invented</strong> (ph·∫£i d√πng V3)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;">was <strong>flew</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">was <strong>flown</strong> (V3 c·ªßa fly)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;">The car <strong>were</strong> made</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The car <strong>was</strong> made (s·ªë √≠t)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;">The cars <strong>was</strong> made</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The cars <strong>were</strong> made (s·ªë nhi·ªÅu)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;">When the phone <strong>was invented</strong>?</td>
              <td style="padding: 10px; border: 1px solid #ddd;">When <strong>was the phone invented</strong>?</td>
            </tr>
          </table>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">üéì Khi n√†o d√πng C√¢u B·ªã ƒê·ªông?</h3>
          <ul style="line-height: 1.8;">
            <li>‚úÖ Khi <strong>kh√¥ng bi·∫øt</strong> ai ƒë√£ l√†m h√†nh ƒë·ªông ƒë√≥</li>
            <li>‚úÖ Khi ng∆∞·ªùi l√†m <strong>kh√¥ng quan tr·ªçng</strong> (quan tr·ªçng l√† k·∫øt qu·∫£)</li>
            <li>‚úÖ Khi mu·ªën <strong>nh·∫•n m·∫°nh v√†o s·ª± v·∫≠t/vi·ªác</strong>, kh√¥ng ph·∫£i ng∆∞·ªùi l√†m</li>
            <li>‚úÖ Trong vƒÉn vi·∫øt <strong>trang tr·ªçng</strong>, khoa h·ªçc, l·ªãch s·ª≠</li>
          </ul>

          <div class="theory-panel__example" style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin-top: 10px;">
            <strong>üìö V√≠ d·ª• th·ª±c t·∫ø:</strong><br>
            ‚Ä¢ Penicillin <strong>was discovered</strong> in 1928. (Ai ph√°t hi·ªán? Kh√¥ng quan tr·ªçng b·∫±ng vi·ªác n√≥ ƒë∆∞·ª£c ph√°t hi·ªán!)<br>
            ‚Ä¢ The pyramids <strong>were built</strong> thousands of years ago. (Ai x√¢y? Kh√¥ng ai bi·∫øt ch·∫Øc!)<br>
            ‚Ä¢ My bike <strong>was stolen</strong> yesterday. (T√¥i kh√¥ng bi·∫øt ai l·∫•y!)
          </div>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/sentence-build.js"></script>
  <script src="../js/exercises/sentence-rewrite.js"></script>
  <script src="../js/exercises/error-correct.js"></script>
  <script src="../js/exercises/translation.js"></script>
  <script src="../js/exercises/open-ended.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'unit-12-famous-inventions';
    const DATA_PATH = '../data/unit-12-famous-inventions.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x üî•';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
