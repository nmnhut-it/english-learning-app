<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit 3: Carnival - Comparatives & Superlatives | English Grammar Games</title>
  <meta name="description" content="Practice comparative and superlative adjectives with interactive exercises">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Unit 3: Carnival</h1>
          <p class="game-header__subtitle">Comparatives & Superlatives</p>

          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">GiÃ¡o viÃªn:</span>
              <span class="game-info__value">Nguyá»…n Minh Nhá»±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">Há»c sinh:</span>
              <span class="game-info__value"></span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">Äiá»ƒm</span>
            <span class="stat__value stat__value--primary" id="current-score">â­ 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Tiáº¿n Ä‘á»™</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>ğŸ“– TÃ i liá»‡u ngá»¯ phÃ¡p</span>
        <span class="theory-panel__icon" id="theory-icon">â–¼</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <!-- Section 1: Comparative Adjectives -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">1ï¸âƒ£ So SÃ¡nh HÆ¡n (Comparative Adjectives)</h3>
          <p><strong>Khi nÃ o dÃ¹ng?</strong> So sÃ¡nh giá»¯a HAI ngÆ°á»i, váº­t, hoáº·c sá»± viá»‡c.</p>

          <h4 style="margin-top: 1rem; color: var(--primary);">ğŸ“Œ Quy táº¯c táº¡o dáº¡ng so sÃ¡nh hÆ¡n:</h4>

          <div style="margin-left: 1rem;">
            <p><strong>A. TÃ­nh tá»« ngáº¯n (1 Ã¢m tiáº¿t hoáº·c 2 Ã¢m tiáº¿t káº¿t thÃºc -y):</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> TÃ­nh tá»« + <strong>-er</strong> + <strong>than</strong><br><br>
              âœ“ tall â†’ tall<strong>er</strong> than (cao hÆ¡n)<br>
              âœ“ fast â†’ fast<strong>er</strong> than (nhanh hÆ¡n)<br>
              âœ“ cheap â†’ cheap<strong>er</strong> than (ráº» hÆ¡n)<br><br>

              <strong>LÆ°u Ã½ Ä‘áº·c biá»‡t:</strong><br>
              â€¢ Káº¿t thÃºc -y: Ä‘á»•i <strong>y â†’ i</strong> + er<br>
              &nbsp;&nbsp;happy â†’ happ<strong>ier</strong> than, easy â†’ eas<strong>ier</strong> than<br><br>

              â€¢ Káº¿t thÃºc báº±ng 1 phá»¥ Ã¢m (sau 1 nguyÃªn Ã¢m): <strong>nhÃ¢n Ä‘Ã´i</strong> phá»¥ Ã¢m + er<br>
              &nbsp;&nbsp;big â†’ big<strong>ger</strong> than, hot â†’ hot<strong>ter</strong> than, thin â†’ thin<strong>ner</strong> than
            </div>

            <p style="margin-top: 1rem;"><strong>B. TÃ­nh tá»« dÃ i (2+ Ã¢m tiáº¿t):</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> <strong>more</strong> + tÃ­nh tá»« + <strong>than</strong><br><br>
              âœ“ <strong>more</strong> beautiful than (Ä‘áº¹p hÆ¡n)<br>
              âœ“ <strong>more</strong> expensive than (Ä‘áº¯t hÆ¡n)<br>
              âœ“ <strong>more</strong> difficult than (khÃ³ hÆ¡n)<br>
              âœ“ <strong>more</strong> intelligent than (thÃ´ng minh hÆ¡n)
            </div>

            <p style="margin-top: 1rem;"><strong>C. Dáº¡ng báº¥t quy táº¯c (pháº£i thuá»™c lÃ²ng):</strong></p>
            <div class="theory-panel__example">
              good â†’ <strong>better</strong> than (tá»‘t hÆ¡n)<br>
              bad â†’ <strong>worse</strong> than (tá»‡ hÆ¡n)<br>
              far â†’ <strong>farther/further</strong> than (xa hÆ¡n)<br>
              many/much â†’ <strong>more</strong> than (nhiá»u hÆ¡n)<br>
              little â†’ <strong>less</strong> than (Ã­t hÆ¡n)
            </div>
          </div>

          <div style="background: #fff3cd; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
            <strong>ğŸ’¡ Máº¹o nháº­n biáº¿t:</strong> Tháº¥y tá»« <strong>"than"</strong> â†’ DÃ¹ng so sÃ¡nh hÆ¡n!
          </div>
        </div>

        <!-- Section 2: Superlative Adjectives -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">2ï¸âƒ£ So SÃ¡nh Nháº¥t (Superlative Adjectives)</h3>
          <p><strong>Khi nÃ o dÃ¹ng?</strong> So sÃ¡nh Má»˜T ngÆ°á»i/váº­t vá»›i Cáº¢ NHÃ“M (3 ngÆ°á»i trá»Ÿ lÃªn).</p>

          <h4 style="margin-top: 1rem; color: var(--primary);">ğŸ“Œ Quy táº¯c táº¡o dáº¡ng so sÃ¡nh nháº¥t:</h4>

          <div style="margin-left: 1rem;">
            <p><strong>A. TÃ­nh tá»« ngáº¯n:</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> <strong>the</strong> + tÃ­nh tá»« + <strong>-est</strong><br><br>
              âœ“ <strong>the</strong> tall<strong>est</strong> (cao nháº¥t)<br>
              âœ“ <strong>the</strong> fast<strong>est</strong> (nhanh nháº¥t)<br>
              âœ“ <strong>the</strong> cheap<strong>est</strong> (ráº» nháº¥t)<br><br>

              <strong>LÆ°u Ã½ Ä‘áº·c biá»‡t:</strong><br>
              â€¢ Káº¿t thÃºc -y: Ä‘á»•i <strong>y â†’ i</strong> + est<br>
              &nbsp;&nbsp;<strong>the</strong> happ<strong>iest</strong>, <strong>the</strong> eas<strong>iest</strong><br><br>

              â€¢ NhÃ¢n Ä‘Ã´i phá»¥ Ã¢m cuá»‘i: <strong>the</strong> big<strong>gest</strong>, <strong>the</strong> hot<strong>test</strong>
            </div>

            <p style="margin-top: 1rem;"><strong>B. TÃ­nh tá»« dÃ i:</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> <strong>the most</strong> + tÃ­nh tá»«<br><br>
              âœ“ <strong>the most</strong> beautiful (Ä‘áº¹p nháº¥t)<br>
              âœ“ <strong>the most</strong> expensive (Ä‘áº¯t nháº¥t)<br>
              âœ“ <strong>the most</strong> difficult (khÃ³ nháº¥t)<br>
              âœ“ <strong>the most</strong> intelligent (thÃ´ng minh nháº¥t)
            </div>

            <p style="margin-top: 1rem;"><strong>C. Dáº¡ng báº¥t quy táº¯c:</strong></p>
            <div class="theory-panel__example">
              good â†’ <strong>the best</strong> (tá»‘t nháº¥t)<br>
              bad â†’ <strong>the worst</strong> (tá»‡ nháº¥t)<br>
              far â†’ <strong>the farthest/furthest</strong> (xa nháº¥t)<br>
              many/much â†’ <strong>the most</strong> (nhiá»u nháº¥t)<br>
              little â†’ <strong>the least</strong> (Ã­t nháº¥t)
            </div>
          </div>

          <div style="background: #fff3cd; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
            <strong>ğŸ’¡ Máº¹o nháº­n biáº¿t:</strong> Tháº¥y <strong>"in/of the..."</strong> (trong..., cá»§a...) â†’ DÃ¹ng so sÃ¡nh nháº¥t!<br>
            VÃ­ dá»¥: the tallest <strong>in</strong> the class, the best <strong>of</strong> all
          </div>
        </div>

        <!-- Section 3: As...as Comparisons -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">3ï¸âƒ£ So SÃ¡nh Báº±ng (As...as)</h3>
          <p><strong>Khi nÃ o dÃ¹ng?</strong> So sÃ¡nh hai ngÆ°á»i/váº­t cÃ³ má»©c Ä‘á»™ Báº°NG NHAU hoáº·c KHÃ”NG Báº°NG NHAU.</p>

          <div class="theory-panel__example">
            <strong>Kháº³ng Ä‘á»‹nh:</strong> <strong>as</strong> + tÃ­nh tá»« + <strong>as</strong><br>
            âœ“ Tom is <strong>as tall as</strong> John. (Tom cao báº±ng John)<br>
            âœ“ This book is <strong>as interesting as</strong> that one.<br><br>

            <strong>Phá»§ Ä‘á»‹nh:</strong> <strong>not as</strong> + tÃ­nh tá»« + <strong>as</strong><br>
            âœ“ Coffee is <strong>not as popular as</strong> tea in England.<br>
            &nbsp;&nbsp;(CÃ  phÃª khÃ´ng phá»• biáº¿n báº±ng trÃ  á»Ÿ Anh)<br>
            âœ“ This exercise is <strong>not as difficult as</strong> the last one.
          </div>

          <div style="background: #d1ecf1; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
            <strong>âš ï¸ LÆ°u Ã½:</strong> KhÃ´ng dÃ¹ng "more" hay "-er" vá»›i cáº¥u trÃºc as...as!<br>
            âŒ as more tall as âŒ as taller as<br>
            âœ… as tall as
          </div>
        </div>

        <!-- Section 4: Too and Enough -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">4ï¸âƒ£ Too vÃ  Enough</h3>

          <div style="margin-left: 1rem;">
            <p><strong>A. TOO (quÃ¡ - mang nghÄ©a phá»§ Ä‘á»‹nh)</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> <strong>too</strong> + tÃ­nh tá»« + (for sb) + to + Ä‘á»™ng tá»«<br>
              <strong>NghÄ©a:</strong> QuÃ¡...Ä‘áº¿n ná»—i khÃ´ng thá»ƒ...<br><br>

              âœ“ This coffee is <strong>too hot</strong>. I can't drink it.<br>
              &nbsp;&nbsp;(CÃ  phÃª quÃ¡ nÃ³ng, tÃ´i khÃ´ng thá»ƒ uá»‘ng Ä‘Æ°á»£c)<br><br>

              âœ“ The box is <strong>too heavy for me to</strong> carry.<br>
              &nbsp;&nbsp;(CÃ¡i há»™p quÃ¡ náº·ng, tÃ´i khÃ´ng thá»ƒ mang Ä‘Æ°á»£c)<br><br>

              âœ“ He is <strong>too young to</strong> drive a car.<br>
              &nbsp;&nbsp;(Anh áº¥y quÃ¡ tráº» Ä‘á»ƒ lÃ¡i xe)
            </div>

            <p style="margin-top: 1rem;"><strong>B. ENOUGH (Ä‘á»§ - mang nghÄ©a tÃ­ch cá»±c)</strong></p>
            <div class="theory-panel__example">
              <strong>CÃ´ng thá»©c:</strong> tÃ­nh tá»« + <strong>enough</strong> + (for sb) + to + Ä‘á»™ng tá»«<br>
              <strong>NghÄ©a:</strong> Äá»§...Ä‘á»ƒ cÃ³ thá»ƒ...<br><br>

              âœ“ Are you <strong>tall enough to</strong> reach the shelf?<br>
              &nbsp;&nbsp;(Báº¡n cÃ³ Ä‘á»§ cao Ä‘á»ƒ vá»›i tá»›i ká»‡ khÃ´ng?)<br><br>

              âœ“ She is <strong>old enough to</strong> go to school.<br>
              &nbsp;&nbsp;(CÃ´ bÃ© Ä‘á»§ tuá»•i Ä‘á»ƒ Ä‘i há»c)<br><br>

              âœ“ The room is <strong>big enough for</strong> 20 people.<br>
              &nbsp;&nbsp;(CÄƒn phÃ²ng Ä‘á»§ lá»›n cho 20 ngÆ°á»i)
            </div>

            <div style="background: #f8d7da; padding: 0.8rem; margin-top: 1rem; border-radius: 4px;">
              <strong>âš ï¸ Vá»Š TRÃ QUAN TRá»ŒNG:</strong><br>
              <strong>too</strong> + tÃ­nh tá»« (too Ä‘á»©ng TRÆ¯á»šC)<br>
              tÃ­nh tá»« + <strong>enough</strong> (enough Ä‘á»©ng SAU)<br><br>

              âœ… too big / big enough<br>
              âŒ big too / enough big
            </div>
          </div>
        </div>

        <!-- Section 5: Common Mistakes -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">âŒ Lá»—i ThÆ°á»ng Gáº·p</h3>

          <div class="theory-panel__example">
            <strong>1. Nháº§m láº«n giá»¯a so sÃ¡nh hÆ¡n vÃ  so sÃ¡nh nháº¥t:</strong><br>
            âŒ She is the taller than me. â†’ âœ… She is <strong>taller</strong> than me.<br>
            âŒ He is the most tall in class. â†’ âœ… He is <strong>the tallest</strong> in class.<br><br>

            <strong>2. DÃ¹ng "more" vá»›i tÃ­nh tá»« ngáº¯n:</strong><br>
            âŒ more tall â†’ âœ… <strong>taller</strong><br>
            âŒ more cheap â†’ âœ… <strong>cheaper</strong><br>
            âŒ more good â†’ âœ… <strong>better</strong><br><br>

            <strong>3. DÃ¹ng "-er/-est" vá»›i tÃ­nh tá»« dÃ i:</strong><br>
            âŒ beautifuler â†’ âœ… <strong>more beautiful</strong><br>
            âŒ expensivest â†’ âœ… <strong>the most expensive</strong><br><br>

            <strong>4. QuÃªn "the" trong so sÃ¡nh nháº¥t:</strong><br>
            âŒ She is tallest girl. â†’ âœ… She is <strong>the</strong> tallest girl.<br>
            âŒ This is most expensive car. â†’ âœ… This is <strong>the</strong> most expensive car.<br><br>

            <strong>5. Nháº§m láº«n vá»‹ trÃ­ too vÃ  enough:</strong><br>
            âŒ big too â†’ âœ… <strong>too big</strong><br>
            âŒ enough big â†’ âœ… <strong>big enough</strong>
          </div>
        </div>

        <!-- Quick Reference Table -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">ğŸ“Š Báº£ng Tham Kháº£o Nhanh</h3>
          <div class="theory-panel__example">
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
              <tr style="background: var(--primary); color: white;">
                <th style="padding: 0.5rem; border: 1px solid #ddd;">TÃ­nh tá»« gá»‘c</th>
                <th style="padding: 0.5rem; border: 1px solid #ddd;">So sÃ¡nh hÆ¡n</th>
                <th style="padding: 0.5rem; border: 1px solid #ddd;">So sÃ¡nh nháº¥t</th>
              </tr>
              <tr>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">tall</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">taller than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the tallest</td>
              </tr>
              <tr style="background: #f5f5f5;">
                <td style="padding: 0.5rem; border: 1px solid #ddd;">happy</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">happier than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the happiest</td>
              </tr>
              <tr>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">big</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">bigger than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the biggest</td>
              </tr>
              <tr style="background: #f5f5f5;">
                <td style="padding: 0.5rem; border: 1px solid #ddd;">beautiful</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">more beautiful than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the most beautiful</td>
              </tr>
              <tr>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">good</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">better than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the best</td>
              </tr>
              <tr style="background: #f5f5f5;">
                <td style="padding: 0.5rem; border: 1px solid #ddd;">bad</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">worse than</td>
                <td style="padding: 0.5rem; border: 1px solid #ddd;">the worst</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Äang táº£i...</h2>
        <p>Vui lÃ²ng Ä‘á»£i trong khi chÃºng tÃ´i táº£i bÃ i táº­p.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'unit-3-carnival';
    const DATA_PATH = '../data/unit-3-carnival.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x ğŸ”¥';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Lá»—i táº£i trÃ² chÆ¡i</h2>
            <p>Xin lá»—i, chÃºng tÃ´i khÃ´ng thá»ƒ táº£i dá»¯ liá»‡u bÃ i táº­p. Vui lÃ²ng thá»­ táº£i láº¡i trang.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Lá»—i: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Táº£i láº¡i trang</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
