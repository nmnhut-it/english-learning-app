<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade 6 - Unit 2: My House | English Grammar Games</title>
  <meta name="description" content="Practice Possessive 's, There is/are, and Prepositions of Place for Grade 6">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Grade 6 - Unit 2: My House</h1>
          <p class="game-header__subtitle">Possessive 's, There is/are & Prepositions of Place</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">GiÃ¡o viÃªn:</span>
              <span class="game-info__value">Nguyá»…n Minh Nhá»±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">Há»c sinh:</span>
              <span class="game-info__value">Lá»›p 6</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">Äiá»ƒm</span>
            <span class="stat__value stat__value--primary" id="current-score">â­ 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Tiáº¿n Ä‘á»™</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>ğŸ“– TÃ i liá»‡u ngá»¯ phÃ¡p</span>
        <span class="theory-panel__icon" id="theory-icon">â–¼</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">1. Sá»Ÿ há»¯u cÃ¡ch (Possessive 's)</h3>

          <p><strong>ğŸ¯ CÃ´ng dá»¥ng:</strong> DÃ¹ng Ä‘á»ƒ chá»‰ cÃ¡i gÃ¬ Ä‘Ã³ thuá»™c vá» ai Ä‘Ã³</p>

          <p><strong>ğŸ“ Cáº¥u trÃºc:</strong></p>
          <p class="text-center" style="font-size: 1.2em; color: var(--primary); background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>TÃªn ngÆ°á»i/váº­t + 's + danh tá»«</strong>
          </p>

          <div class="theory-panel__example">
            <strong>âœ… VÃ­ dá»¥:</strong><br>
            â€¢ <strong>Hoa's father</strong> = cha cá»§a Hoa<br>
            â€¢ <strong>Nick's room</strong> = phÃ²ng cá»§a Nick<br>
            â€¢ <strong>My brother's pen</strong> = cÃ¢y viáº¿t cá»§a anh trai tÃ´i<br>
            â€¢ <strong>The dog's house</strong> = nhÃ  cá»§a con chÃ³<br>
            â€¢ <strong>My sister's bag</strong> = cáº·p cá»§a chá»‹/em gÃ¡i tÃ´i
          </div>

          <p class="text-note"><strong>ğŸ’¡ Máº¹o nhá»›:</strong></p>
          <ul>
            <li>Vá»›i danh tá»« sá»‘ Ã­t: thÃªm <strong>'s</strong> (Nick â†’ Nick's)</li>
            <li>Vá»›i danh tá»« sá»‘ nhiá»u cÃ³ 's': chá»‰ thÃªm <strong>'</strong> (students â†’ students')</li>
            <li>Vá»›i danh tá»« sá»‘ nhiá»u khÃ´ng cÃ³ 's': thÃªm <strong>'s</strong> (children â†’ children's)</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">2. There is / There are</h3>

          <p><strong>ğŸ¯ CÃ´ng dá»¥ng:</strong> DÃ¹ng Ä‘á»ƒ diá»…n táº£ sá»± tá»“n táº¡i, cÃ³ cÃ¡i gÃ¬ Ä‘Ã³ á»Ÿ Ä‘Ã¢u Ä‘Ã³</p>

          <p><strong>ğŸ“ Cáº¥u trÃºc:</strong></p>
          <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
            <tr style="background: var(--bg-light);">
              <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Kháº³ng Ä‘á»‹nh</th>
              <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Phá»§ Ä‘á»‹nh</th>
              <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Nghi váº¥n</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;">
                There <strong>is</strong> + a/an + N (sá»‘ Ã­t)<br>
                There <strong>are</strong> + N (sá»‘ nhiá»u)
              </td>
              <td style="padding: 10px; border: 1px solid #ddd;">
                There <strong>isn't</strong> + a/an + N<br>
                There <strong>aren't</strong> + N (sá»‘ nhiá»u)
              </td>
              <td style="padding: 10px; border: 1px solid #ddd;">
                <strong>Is there</strong> + a/an + N?<br>
                <strong>Are there</strong> + N (sá»‘ nhiá»u)?
              </td>
            </tr>
          </table>

          <div class="theory-panel__example">
            <strong>âœ… VÃ­ dá»¥:</strong><br>
            â€¢ There <strong>is</strong> a cat next to the window. (CÃ³ má»™t con mÃ¨o bÃªn cáº¡nh cá»­a sá»•.)<br>
            â€¢ There <strong>are</strong> two cats next to the window. (CÃ³ hai con mÃ¨o bÃªn cáº¡nh cá»­a sá»•.)<br>
            â€¢ There <strong>isn't</strong> a TV in my room. (KhÃ´ng cÃ³ TV trong phÃ²ng tÃ´i.)<br>
            â€¢ There <strong>aren't</strong> any books on the desk. (KhÃ´ng cÃ³ quyá»ƒn sÃ¡ch nÃ o trÃªn bÃ n.)<br>
            â€¢ <strong>Is there</strong> a kitchen in your house? (CÃ³ nhÃ  báº¿p trong nhÃ  báº¡n khÃ´ng?)<br>
            â€¢ <strong>Are there</strong> five rooms in your house? (CÃ³ nÄƒm phÃ²ng trong nhÃ  báº¡n khÃ´ng?)
          </div>

          <p class="text-note"><strong>âš ï¸ LÆ°u Ã½ quan trá»ng:</strong></p>
          <ul>
            <li><strong>Sá»‘ Ã­t (1 cÃ¡i):</strong> dÃ¹ng <strong>is</strong> â†’ There is <u>a</u> desk</li>
            <li><strong>Sá»‘ nhiá»u (2+ cÃ¡i):</strong> dÃ¹ng <strong>are</strong> â†’ There are <u>two</u> desks</li>
            <li><strong>CÃ³ nhiá»u danh tá»«:</strong> chia Ä‘á»™ng tá»« theo danh tá»« Ä‘áº§u tiÃªn<br>
              â†’ There <strong>is</strong> a kitchen and two bedrooms. (vÃ¬ 'a kitchen' lÃ  sá»‘ Ã­t)</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">3. Giá»›i tá»« chá»‰ vá»‹ trÃ­ (Prepositions of Place)</h3>

          <p><strong>ğŸ¯ CÃ´ng dá»¥ng:</strong> DÃ¹ng Ä‘á»ƒ chá»‰ vá»‹ trÃ­ cá»§a ngÆ°á»i hoáº·c váº­t</p>

          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: var(--bg-light);">
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Giá»›i tá»«</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">NghÄ©a</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">VÃ­ dá»¥</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>in</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">trong, á»Ÿ bÃªn trong</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The cat is <strong>in</strong> the box. (MÃ¨o á»Ÿ trong há»™p.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>on</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">trÃªn, á»Ÿ trÃªn bá» máº·t</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The book is <strong>on</strong> the table. (SÃ¡ch á»Ÿ trÃªn bÃ n.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>under</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">dÆ°á»›i, á»Ÿ phÃ­a dÆ°á»›i</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The bag is <strong>under</strong> the bed. (Cáº·p á»Ÿ dÆ°á»›i giÆ°á»ng.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>next to / beside</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">bÃªn cáº¡nh</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The lamp is <strong>next to</strong> the bed. (ÄÃ¨n á»Ÿ bÃªn cáº¡nh giÆ°á»ng.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>behind</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">phÃ­a sau, Ä‘áº±ng sau</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The TV is <strong>behind</strong> you. (TV á»Ÿ phÃ­a sau báº¡n.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>in front of</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">phÃ­a trÆ°á»›c, Ä‘áº±ng trÆ°á»›c</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The dog is <strong>in front of</strong> the house. (ChÃ³ á»Ÿ trÆ°á»›c nhÃ .)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>between</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">á»Ÿ giá»¯a (hai váº­t)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The sofa is <strong>between</strong> the door and the window. (Gháº¿ sofa á»Ÿ giá»¯a cá»­a vÃ  cá»­a sá»•.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>among</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">á»Ÿ giá»¯a (nhiá»u váº­t)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She sits <strong>among</strong> her friends. (CÃ´ áº¥y ngá»“i giá»¯a báº¡n bÃ¨.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>above / over</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">á»Ÿ phÃ­a trÃªn (khÃ´ng cháº¡m)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The clock is <strong>above</strong> the door. (Äá»“ng há»“ á»Ÿ trÃªn cá»­a.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>below</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">á»Ÿ phÃ­a dÆ°á»›i (khÃ´ng cháº¡m)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The picture is <strong>below</strong> the window. (Tranh á»Ÿ dÆ°á»›i cá»­a sá»•.)</td>
            </tr>
          </table>

          <p class="text-note"><strong>ğŸ’¡ PhÃ¢n biá»‡t cÃ¡c giá»›i tá»«:</strong></p>
          <ul>
            <li><strong>in</strong> = trong khÃ´ng gian kÃ­n (in the box, in the room, in the house)</li>
            <li><strong>on</strong> = trÃªn bá» máº·t cÃ³ tiáº¿p xÃºc (on the table, on the wall, on the floor)</li>
            <li><strong>at</strong> = táº¡i má»™t Ä‘iá»ƒm cá»¥ thá»ƒ (at the door, at the window, at home)</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">4. Tá»« vá»±ng vá» nhÃ  cá»­a (House Vocabulary)</h3>

          <p><strong>ğŸ  Loáº¡i nhÃ  (Types of Houses):</strong></p>
          <ul>
            <li><strong>town house</strong> (nhÃ  phá»‘) - nhÃ  trong thÃ nh phá»‘</li>
            <li><strong>country house</strong> (nhÃ  nÃ´ng thÃ´n) - nhÃ  á»Ÿ vÃ¹ng quÃª</li>
            <li><strong>flat / apartment</strong> (cÄƒn há»™) - nhÃ  trong chung cÆ°</li>
            <li><strong>villa</strong> (biá»‡t thá»±) - nhÃ  sang trá»ng, rá»™ng rÃ£i</li>
            <li><strong>stilt house</strong> (nhÃ  sÃ n) - nhÃ  truyá»n thá»‘ng miá»n nÃºi</li>
          </ul>

          <p><strong>ğŸšª CÃ¡c phÃ²ng (Rooms):</strong></p>
          <ul>
            <li><strong>living room</strong> (phÃ²ng khÃ¡ch) - nÆ¡i tiáº¿p khÃ¡ch, xem TV</li>
            <li><strong>bedroom</strong> (phÃ²ng ngá»§) - nÆ¡i ngá»§ nghá»‰</li>
            <li><strong>kitchen</strong> (nhÃ  báº¿p) - nÆ¡i náº¥u Äƒn</li>
            <li><strong>bathroom</strong> (phÃ²ng táº¯m) - nÆ¡i táº¯m rá»­a</li>
            <li><strong>dining room</strong> (phÃ²ng Äƒn) - nÆ¡i Äƒn cÆ¡m</li>
            <li><strong>hall / hallway</strong> (hÃ nh lang) - lá»‘i Ä‘i trong nhÃ </li>
            <li><strong>attic</strong> (gÃ¡c mÃ¡i) - phÃ²ng trÃªn gÃ¡c</li>
            <li><strong>garage</strong> (nhÃ  Ä‘á»ƒ xe) - nÆ¡i Ä‘á»— xe</li>
          </ul>

          <p><strong>ğŸ›‹ï¸ Äá»“ ná»™i tháº¥t (Furniture):</strong></p>
          <ul>
            <li><strong>sofa</strong> (gháº¿ sofa) - gháº¿ dÃ i trong phÃ²ng khÃ¡ch</li>
            <li><strong>lamp</strong> (Ä‘Ã¨n) - Ä‘Ã¨n chiáº¿u sÃ¡ng</li>
            <li><strong>wardrobe</strong> (tá»§ quáº§n Ã¡o) - nÆ¡i treo quáº§n Ã¡o</li>
            <li><strong>desk</strong> (bÃ n há»c/lÃ m viá»‡c) - bÃ n Ä‘á»ƒ há»c bÃ i</li>
            <li><strong>bed</strong> (giÆ°á»ng) - nÆ¡i ngá»§</li>
            <li><strong>table</strong> (bÃ n) - bÃ n Äƒn, bÃ n trÃ </li>
            <li><strong>chair</strong> (gháº¿) - gháº¿ ngá»“i</li>
            <li><strong>bookshelf</strong> (ká»‡ sÃ¡ch) - nÆ¡i Ä‘á»ƒ sÃ¡ch</li>
            <li><strong>TV</strong> (tivi) - Ä‘á»ƒ xem phim</li>
            <li><strong>fridge</strong> (tá»§ láº¡nh) - Ä‘á»ƒ Ä‘á»“ Äƒn, Ä‘á»“ uá»‘ng</li>
            <li><strong>cupboard</strong> (tá»§ chÃ©n) - Ä‘á»ƒ bÃ¡t Ä‘Ä©a</li>
            <li><strong>curtain</strong> (rÃ¨m cá»­a) - che cá»­a sá»•</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'g6-unit-2-my-house';
    const DATA_PATH = '../data/g6-unit-2-my-house.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x ğŸ”¥';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
