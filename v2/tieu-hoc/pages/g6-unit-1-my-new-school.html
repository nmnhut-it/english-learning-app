<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade 6 - Unit 1: My New School | English Grammar Games</title>
  <meta name="description" content="Practice Present Simple tense and school vocabulary for Grade 6">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Grade 6 - Unit 1: My New School</h1>
          <p class="game-header__subtitle">Present Simple Tense & School Vocabulary</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">GiÃ¡o viÃªn:</span>
              <span class="game-info__value">Nguyá»…n Minh Nhá»±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">Há»c sinh:</span>
              <span class="game-info__value">Lá»›p 6</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">Äiá»ƒm</span>
            <span class="stat__value stat__value--primary" id="current-score">â­ 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Tiáº¿n Ä‘á»™</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>ğŸ“– TÃ i liá»‡u ngá»¯ phÃ¡p</span>
        <span class="theory-panel__icon" id="theory-icon">â–¼</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">ThÃ¬ Hiá»‡n Táº¡i ÄÆ¡n (Present Simple Tense)</h3>

          <p style="font-style: italic; color: var(--text-light); margin-bottom: 16px;">
            ThÃ¬ hiá»‡n táº¡i Ä‘Æ¡n dÃ¹ng Ä‘á»ƒ nÃ³i vá» nhá»¯ng viá»‡c xáº£y ra thÆ°á»ng xuyÃªn, sá»± tháº­t hiá»ƒn nhiÃªn, hoáº·c thÃ³i quen hÃ ng ngÃ y cá»§a chÃºng ta.
          </p>

          <h4>ğŸ“Œ 1. CÃ´ng thá»©c cÆ¡ báº£n:</h4>

          <div style="background: #f0f7ff; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
            <p><strong>A. Äá»™ng tá»« thÆ°á»ng (Regular Verbs):</strong></p>
            <table style="width: 100%; margin-top: 8px;">
              <tr>
                <td style="padding: 6px;"><strong>âœ… Kháº³ng Ä‘á»‹nh:</strong></td>
                <td style="padding: 6px;">
                  â€¢ I/You/We/They + V<sub>nguyÃªn máº«u</sub><br>
                  â€¢ He/She/It + V-s/es
                </td>
              </tr>
              <tr>
                <td style="padding: 6px;"><strong>âŒ Phá»§ Ä‘á»‹nh:</strong></td>
                <td style="padding: 6px;">
                  â€¢ I/You/We/They + <strong>don't</strong> + V<sub>nguyÃªn máº«u</sub><br>
                  â€¢ He/She/It + <strong>doesn't</strong> + V<sub>nguyÃªn máº«u</sub>
                </td>
              </tr>
              <tr>
                <td style="padding: 6px;"><strong>â“ Nghi váº¥n:</strong></td>
                <td style="padding: 6px;">
                  â€¢ <strong>Do</strong> + I/you/we/they + V<sub>nguyÃªn máº«u</sub>?<br>
                  â€¢ <strong>Does</strong> + he/she/it + V<sub>nguyÃªn máº«u</sub>?
                </td>
              </tr>
            </table>
          </div>

          <div class="theory-panel__example">
            <strong>ğŸ’¡ VÃ­ dá»¥ minh há»a:</strong><br>
            âœ… I <strong>study</strong> English every day. â†’ TÃ´i há»c tiáº¿ng Anh má»—i ngÃ y.<br>
            âœ… She <strong>goes</strong> to school by bike. â†’ CÃ´ áº¥y Ä‘i há»c báº±ng xe Ä‘áº¡p.<br>
            âŒ They <strong>don't play</strong> football on Mondays. â†’ Há» khÃ´ng chÆ¡i bÃ³ng Ä‘Ã¡ vÃ o thá»© Hai.<br>
            â“ <strong>Do</strong> you like music? â†’ Báº¡n cÃ³ thÃ­ch Ã¢m nháº¡c khÃ´ng?
          </div>

          <div style="background: #fff4e6; padding: 12px; border-radius: 8px; margin-top: 16px;">
            <p><strong>B. Äá»™ng tá»« "to be" (am/is/are):</strong></p>
            <table style="width: 100%; margin-top: 8px;">
              <tr>
                <td style="padding: 6px; width: 120px;"><strong>âœ… Kháº³ng Ä‘á»‹nh:</strong></td>
                <td style="padding: 6px;">I <strong>am</strong> / He/She/It <strong>is</strong> / You/We/They <strong>are</strong></td>
              </tr>
              <tr>
                <td style="padding: 6px;"><strong>âŒ Phá»§ Ä‘á»‹nh:</strong></td>
                <td style="padding: 6px;">I <strong>am not</strong> / He/She/It <strong>isn't</strong> / You/We/They <strong>aren't</strong></td>
              </tr>
              <tr>
                <td style="padding: 6px;"><strong>â“ Nghi váº¥n:</strong></td>
                <td style="padding: 6px;"><strong>Am</strong> I? / <strong>Is</strong> he/she/it? / <strong>Are</strong> you/we/they?</td>
              </tr>
            </table>
          </div>

          <div class="theory-panel__example" style="margin-top: 12px;">
            <strong>ğŸ’¡ VÃ­ dá»¥:</strong><br>
            âœ… I <strong>am</strong> a student. â†’ TÃ´i lÃ  há»c sinh.<br>
            âŒ She <strong>isn't</strong> at home. â†’ CÃ´ áº¥y khÃ´ng á»Ÿ nhÃ .<br>
            â“ <strong>Are</strong> they your friends? â†’ Há» cÃ³ pháº£i báº¡n cá»§a báº¡n khÃ´ng?
          </div>
        </div>

        <div class="theory-panel__section">
          <h4>ğŸ“Œ 2. Khi nÃ o dÃ¹ng thÃ¬ Hiá»‡n táº¡i ÄÆ¡n?</h4>
          <ul style="list-style: none; padding-left: 0;">
            <li style="margin-bottom: 12px;">
              <strong>ğŸŒ Sá»± tháº­t hiá»ƒn nhiÃªn, chÃ¢n lÃ½:</strong><br>
              <em>The sun rises in the east.</em> (Máº·t trá»i má»c á»Ÿ phÃ­a Ä‘Ã´ng.)<br>
              <em>Water boils at 100Â°C.</em> (NÆ°á»›c sÃ´i á»Ÿ 100 Ä‘á»™ C.)
            </li>
            <li style="margin-bottom: 12px;">
              <strong>ğŸ”„ ThÃ³i quen, hÃ nh Ä‘á»™ng láº·p Ä‘i láº·p láº¡i:</strong><br>
              <em>She goes to the gym every day.</em> (CÃ´ áº¥y Ä‘i phÃ²ng gym má»—i ngÃ y.)<br>
              <em>I always brush my teeth before bed.</em> (TÃ´i luÃ´n Ä‘Ã¡nh rÄƒng trÆ°á»›c khi Ä‘i ngá»§.)
            </li>
            <li style="margin-bottom: 12px;">
              <strong>ğŸ• Lá»‹ch trÃ¬nh, thá»i gian biá»ƒu:</strong><br>
              <em>The train leaves at 6 p.m.</em> (TÃ u rá»i Ä‘i lÃºc 6 giá» chiá»u.)<br>
              <em>School starts at 7:30.</em> (TrÆ°á»ng há»c báº¯t Ä‘áº§u lÃºc 7:30.)
            </li>
            <li>
              <strong>ğŸ’­ Suy nghÄ©, cáº£m xÃºc, nháº­n thá»©c:</strong><br>
              <em>I believe you.</em> (TÃ´i tin báº¡n.)<br>
              <em>She loves chocolate.</em> (CÃ´ áº¥y yÃªu thÃ­ch sÃ´-cÃ´-la.)
            </li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h4>ğŸ“Œ 3. Dáº¥u hiá»‡u nháº­n biáº¿t:</h4>

          <div style="background: #e8f5e9; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
            <p><strong>ğŸ”” Tráº¡ng tá»« táº§n suáº¥t (Adverbs of Frequency):</strong></p>
            <p style="margin-left: 16px;">
              â€¢ <strong>always</strong> (luÃ´n luÃ´n) - 100%<br>
              â€¢ <strong>usually</strong> (thÆ°á»ng xuyÃªn) - 80%<br>
              â€¢ <strong>often</strong> (thÆ°á»ng) - 60%<br>
              â€¢ <strong>sometimes</strong> (thá»‰nh thoáº£ng) - 40%<br>
              â€¢ <strong>rarely/seldom</strong> (hiáº¿m khi) - 20%<br>
              â€¢ <strong>never</strong> (khÃ´ng bao giá») - 0%
            </p>
          </div>

          <div style="background: #fce4ec; padding: 12px; border-radius: 8px;">
            <p><strong>ğŸ“… Cá»¥m tá»« chá»‰ thá»i gian:</strong></p>
            <p style="margin-left: 16px;">
              â€¢ <strong>every</strong> day/week/month/year (má»—i ngÃ y/tuáº§n/thÃ¡ng/nÄƒm)<br>
              â€¢ <strong>on</strong> Mondays/Tuesdays... (vÃ o cÃ¡c thá»© Hai/Ba...)<br>
              â€¢ <strong>once/twice</strong> a week (má»™t/hai láº§n má»™t tuáº§n)<br>
              â€¢ <strong>in the morning/afternoon/evening</strong> (vÃ o buá»•i sÃ¡ng/chiá»u/tá»‘i)
            </p>
          </div>

          <p style="margin-top: 12px; padding: 10px; background: #fff9c4; border-left: 4px solid #fbc02d; border-radius: 4px;">
            <strong>âš ï¸ LÆ°u Ã½ quan trá»ng:</strong> Tráº¡ng tá»« táº§n suáº¥t Ä‘á»©ng <strong>SAU Ä‘á»™ng tá»« "to be"</strong> nhÆ°ng <strong>TRÆ¯á»šC Ä‘á»™ng tá»« thÆ°á»ng</strong>.<br>
            <em>She <strong>is always</strong> happy.</em> (CÃ´ áº¥y luÃ´n vui váº».)<br>
            <em>I <strong>usually study</strong> at night.</em> (TÃ´i thÆ°á»ng há»c vÃ o buá»•i tá»‘i.)
          </p>
        </div>

        <div class="theory-panel__section">
          <h4>ğŸ“Œ 4. Äá»™ng tá»« Ä‘i vá»›i cÃ¡c hoáº¡t Ä‘á»™ng há»c Ä‘Æ°á»ng:</h4>
          <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
            <tr style="background: var(--primary); color: white;">
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Äá»™ng tá»«</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">DÃ¹ng vá»›i</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">VÃ­ dá»¥</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>play</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">football, basketball, music, the guitar</td>
              <td style="padding: 10px; border: 1px solid #ddd;">I <strong>play</strong> football after school.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>do</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">homework, exercise, judo, karate</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>do</strong> homework every evening.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>have</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">lunch, breakfast, lessons, a break</td>
              <td style="padding: 10px; border: 1px solid #ddd;">We <strong>have</strong> English lessons on Monday.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>study</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">English, Math, Science, History</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>studies</strong> English and Math.</td>
            </tr>
          </table>
        </div>

        <div class="theory-panel__section" style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin-top: 16px;">
          <h4>âœï¸ Quy táº¯c thÃªm -s/-es cho ngÃ´i thá»© 3 sá»‘ Ã­t:</h4>
          <ul>
            <li>ThÃ´ng thÆ°á»ng: thÃªm <strong>-s</strong> â†’ work â†’ work<strong>s</strong>, play â†’ play<strong>s</strong></li>
            <li>Káº¿t thÃºc -o, -ch, -sh, -ss, -x: thÃªm <strong>-es</strong> â†’ go â†’ go<strong>es</strong>, watch â†’ watch<strong>es</strong></li>
            <li>Káº¿t thÃºc -y (trÆ°á»›c y lÃ  phá»¥ Ã¢m): Ä‘á»•i y â†’ <strong>ies</strong> â†’ study â†’ stud<strong>ies</strong>, fly â†’ fl<strong>ies</strong></li>
            <li>Káº¿t thÃºc -y (trÆ°á»›c y lÃ  nguyÃªn Ã¢m): thÃªm <strong>-s</strong> â†’ play â†’ play<strong>s</strong>, buy â†’ buy<strong>s</strong></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'g6-unit-1-my-new-school';
    const DATA_PATH = '../data/g6-unit-1-my-new-school.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x ğŸ”¥';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
