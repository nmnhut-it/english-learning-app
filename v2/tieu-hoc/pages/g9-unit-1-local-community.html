<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade 9 - Unit 1: Local Community | English Grammar Games</title>
  <meta name="description" content="Practice question words before to-infinitives and phrasal verbs">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Grade 9 - Unit 1: Local Community</h1>
          <p class="game-header__subtitle">Question Words + To-Infinitives & Phrasal Verbs</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">GiÃ¡o viÃªn:</span>
              <span class="game-info__value">Nguyá»…n Minh Nhá»±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">Há»c sinh:</span>
              <span class="game-info__value">Lá»›p 9</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">Äiá»ƒm</span>
            <span class="stat__value stat__value--primary" id="current-score">â­ 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Tiáº¿n Ä‘á»™</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>ğŸ“– TÃ i liá»‡u ngá»¯ phÃ¡p</span>
        <span class="theory-panel__icon" id="theory-icon">â–¼</span>
      </button>

      <div class="theory-panel__content" id="theory-content">

        <!-- PART 1: Question Words + To-Infinitives -->
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">ğŸ“š PHáº¦N 1: Question Words + To-Infinitives</h3>

          <p style="font-style: italic; color: var(--text-light); margin-bottom: 16px;">
            Cáº¥u trÃºc nÃ y giÃºp báº¡n diá»…n Ä‘áº¡t má»™t cÃ¡ch giÃ¡n tiáº¿p vá» viá»‡c nÃªn lÃ m gÃ¬, Ä‘i Ä‘Ã¢u, khi nÃ o, nhÆ° tháº¿ nÃ o mÃ  khÃ´ng cáº§n Ä‘áº·t cÃ¢u há»i trá»±c tiáº¿p.
          </p>

          <h4>ğŸ“Œ 1. Cáº¥u trÃºc:</h4>
          <div style="background: #f0f7ff; padding: 14px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #2196F3;">
            <p style="font-size: 18px; margin: 0;">
              <strong>Question Word + to + Verb (nguyÃªn máº«u)</strong>
            </p>
            <p style="margin: 8px 0 0 0; color: #666;">
              (what / where / when / how / who / which) + to + V<sub>0</sub>
            </p>
          </div>

          <div class="theory-panel__example">
            <strong>ğŸ’¡ VÃ­ dá»¥ minh há»a:</strong><br><br>
            ğŸ”¹ I don't know <strong>what to do</strong>.<br>
            â†’ TÃ´i khÃ´ng biáº¿t <em>pháº£i lÃ m gÃ¬</em>.<br><br>

            ğŸ”¹ She asked me <strong>where to go</strong>.<br>
            â†’ CÃ´ áº¥y há»i tÃ´i <em>nÃªn Ä‘i Ä‘Ã¢u</em>.<br><br>

            ğŸ”¹ Can you tell me <strong>how to make</strong> this?<br>
            â†’ Báº¡n cÃ³ thá»ƒ chá»‰ tÃ´i <em>cÃ¡ch lÃ m</em> cÃ¡i nÃ y khÃ´ng?<br><br>

            ğŸ”¹ They haven't decided <strong>when to start</strong>.<br>
            â†’ Há» chÆ°a quyáº¿t Ä‘á»‹nh <em>khi nÃ o báº¯t Ä‘áº§u</em>.<br><br>

            ğŸ”¹ I'm wondering <strong>who to contact</strong>.<br>
            â†’ TÃ´i Ä‘ang bÄƒn khoÄƒn <em>nÃªn liÃªn há»‡ vá»›i ai</em>.
          </div>

          <h4 style="margin-top: 20px;">ğŸ“Œ 2. CÃ¡c Ä‘á»™ng tá»« thÆ°á»ng Ä‘i trÆ°á»›c:</h4>
          <div style="background: #e8f5e9; padding: 12px; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
              <tr>
                <td style="padding: 8px; width: 150px;"><strong>âœ“ know</strong></td>
                <td style="padding: 8px;">biáº¿t â†’ I know <strong>how to swim</strong>.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ decide</strong></td>
                <td style="padding: 8px;">quyáº¿t Ä‘á»‹nh â†’ We decided <strong>where to stay</strong>.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ wonder</strong></td>
                <td style="padding: 8px;">bÄƒn khoÄƒn â†’ She wonders <strong>what to wear</strong>.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ ask</strong></td>
                <td style="padding: 8px;">há»i â†’ He asked me <strong>how to get</strong> there.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ tell</strong></td>
                <td style="padding: 8px;">báº£o â†’ Can you tell me <strong>what to do</strong>?</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ show</strong></td>
                <td style="padding: 8px;">chá»‰ â†’ She showed me <strong>how to use</strong> it.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ learn</strong></td>
                <td style="padding: 8px;">há»c â†’ I learned <strong>where to find</strong> help.</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>âœ“ understand</strong></td>
                <td style="padding: 8px;">hiá»ƒu â†’ They understand <strong>when to stop</strong>.</td>
              </tr>
            </table>
          </div>

          <h4 style="margin-top: 20px;">ğŸ“Œ 3. CÃ¡c tá»« Ä‘á»ƒ há»i phá»• biáº¿n:</h4>
          <div style="background: #fff4e6; padding: 12px; border-radius: 8px;">
            <ul style="list-style: none; padding-left: 0;">
              <li style="margin-bottom: 8px;">â“ <strong>what to do/buy/say/eat</strong> - lÃ m gÃ¬ / mua gÃ¬ / nÃ³i gÃ¬ / Äƒn gÃ¬</li>
              <li style="margin-bottom: 8px;">ğŸ“ <strong>where to go/stay/find/buy</strong> - Ä‘i Ä‘Ã¢u / á»Ÿ Ä‘Ã¢u / tÃ¬m á»Ÿ Ä‘Ã¢u / mua á»Ÿ Ä‘Ã¢u</li>
              <li style="margin-bottom: 8px;">â° <strong>when to start/leave/arrive/come</strong> - khi nÃ o báº¯t Ä‘áº§u / rá»i Ä‘i / Ä‘áº¿n / Ä‘áº¿n</li>
              <li style="margin-bottom: 8px;">ğŸ› ï¸ <strong>how to make/use/fix/cook</strong> - cÃ¡ch lÃ m / dÃ¹ng / sá»­a / náº¥u</li>
              <li style="margin-bottom: 8px;">ğŸ‘¤ <strong>who(m) to ask/contact/call/see</strong> - há»i ai / liÃªn há»‡ ai / gá»i ai / gáº·p ai</li>
              <li style="margin-bottom: 8px;">ğŸ¯ <strong>which to choose/select/pick</strong> - chá»n cÃ¡i nÃ o</li>
            </ul>
          </div>

          <div style="background: #ffebee; padding: 12px; border-radius: 8px; margin-top: 16px; border-left: 4px solid #f44336;">
            <p style="margin: 0;"><strong>âš ï¸ LÆ°u Ã½ quan trá»ng:</strong></p>
            <ul style="margin-top: 8px;">
              <li><strong>KHÃ”NG dÃ¹ng</strong> "why to" â†’ DÃ¹ng "why" trá»±c tiáº¿p hoáº·c thay báº±ng cáº¥u trÃºc khÃ¡c</li>
              <li style="margin-top: 8px;">
                âŒ I don't know <s>why to go</s>. <br>
                âœ… I don't know <strong>why I should go</strong>.
              </li>
            </ul>
          </div>
        </div>

        <!-- PART 2: Phrasal Verbs -->
        <div class="theory-panel__section" style="margin-top: 24px;">
          <h3 class="theory-panel__heading">ğŸ”¤ PHáº¦N 2: Phrasal Verbs (Cá»¥m Äá»™ng Tá»«)</h3>

          <p style="font-style: italic; color: var(--text-light); margin-bottom: 16px;">
            Phrasal verbs lÃ  cá»¥m tá»« gá»“m Ä‘á»™ng tá»« + giá»›i tá»«/tráº¡ng tá»« táº¡o thÃ nh nghÄ©a hoÃ n toÃ n má»›i, khÃ¡c vá»›i nghÄ©a gá»‘c cá»§a Ä‘á»™ng tá»«.
          </p>

          <h4>ğŸ“Œ Äá»‹nh nghÄ©a:</h4>
          <div style="background: #f3e5f5; padding: 14px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #9c27b0;">
            <p style="font-size: 18px; margin: 0;">
              <strong>Phrasal Verb = Äá»™ng tá»« + Giá»›i tá»«/Tráº¡ng tá»«</strong>
            </p>
            <p style="margin: 8px 0 0 0; color: #666;">
              VÃ­ dá»¥: look (nhÃ¬n) + after (sau) = <strong>look after</strong> (chÄƒm sÃ³c) â‰  nhÃ¬n phÃ­a sau
            </p>
          </div>

          <h4>ğŸ“Œ CÃ¡c phrasal verbs quan trá»ng trong Unit 1:</h4>

          <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; margin-top: 12px;">
            <tr style="background: var(--primary); color: white;">
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd; width: 180px;">Phrasal Verb</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd; width: 150px;">NghÄ©a</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">VÃ­ dá»¥</th>
            </tr>

            <!-- LOOK verbs -->
            <tr style="background: #e3f2fd;">
              <td colspan="3" style="padding: 8px; border: 1px solid #ddd;">
                <strong>ğŸ‘ï¸ NhÃ³m LOOK (NhÃ¬n, TÃ¬m, Tra cá»©u)</strong>
              </td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>look after</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">chÄƒm sÃ³c</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>looks after</strong> her grandmother.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>look for</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tÃ¬m kiáº¿m</td>
              <td style="padding: 10px; border: 1px solid #ddd;">I'm <strong>looking for</strong> my keys.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>look up</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tra cá»©u (tá»« Ä‘iá»ƒn)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">He <strong>looked up</strong> the word.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>look forward to</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">mong chá»</td>
              <td style="padding: 10px; border: 1px solid #ddd;">We <strong>look forward to</strong> seeing you.</td>
            </tr>

            <!-- GET verbs -->
            <tr style="background: #e8f5e9;">
              <td colspan="3" style="padding: 8px; border: 1px solid #ddd;">
                <strong>ğŸ¤ NhÃ³m GET (Láº¥y, HÃ²a thuáº­n, Tiáº¿p tá»¥c)</strong>
              </td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>get on with</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">hÃ²a thuáº­n vá»›i</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>get on with</strong> their neighbors.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>get over</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">vÆ°á»£t qua (khÃ³ khÄƒn)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>got over</strong> her illness.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>get up</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">thá»©c dáº­y</td>
              <td style="padding: 10px; border: 1px solid #ddd;">I <strong>get up</strong> at 6 a.m.</td>
            </tr>

            <!-- SET/HAND/PUT verbs -->
            <tr style="background: #fff3e0;">
              <td colspan="3" style="padding: 8px; border: 1px solid #ddd;">
                <strong>ğŸ—ï¸ NhÃ³m SET/HAND/PUT (ThÃ nh láº­p, Truyá»n láº¡i, Tá»• chá»©c)</strong>
              </td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>set up</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">thÃ nh láº­p, thiáº¿t láº­p</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>set up</strong> a new business.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>hand down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">truyá»n láº¡i (cho tháº¿ há»‡ sau)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">We <strong>hand down</strong> traditions.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>pass down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">truyá»n láº¡i (kiáº¿n thá»©c)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">Elders <strong>pass down</strong> their wisdom.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>put on</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tá»• chá»©c (sá»± kiá»‡n)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>put on</strong> a festival.</td>
            </tr>

            <!-- FIND/WORK verbs -->
            <tr style="background: #fce4ec;">
              <td colspan="3" style="padding: 8px; border: 1px solid #ddd;">
                <strong>ğŸ” NhÃ³m FIND/WORK (TÃ¬m ra, Giáº£i quyáº¿t)</strong>
              </td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>find out</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tÃ¬m ra, khÃ¡m phÃ¡</td>
              <td style="padding: 10px; border: 1px solid #ddd;">We need to <strong>find out</strong> the truth.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>work out</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tÃ¬m hiá»ƒu, giáº£i quyáº¿t</td>
              <td style="padding: 10px; border: 1px solid #ddd;">I need to <strong>work out</strong> this problem.</td>
            </tr>

            <!-- Other important verbs -->
            <tr style="background: #f3e5f5;">
              <td colspan="3" style="padding: 8px; border: 1px solid #ddd;">
                <strong>ğŸ“¦ CÃ¡c phrasal verbs khÃ¡c quan trá»ng</strong>
              </td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>pull down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">phÃ¡ bá» (tÃ²a nhÃ )</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>pulled down</strong> the old house.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>turn up</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">xuáº¥t hiá»‡n, Ä‘áº¿n</td>
              <td style="padding: 10px; border: 1px solid #ddd;">He didn't <strong>turn up</strong> at the meeting.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>turn down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">tá»« chá»‘i</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>turned down</strong> the offer.</td>
            </tr>
          </table>

          <div style="background: #fff9c4; padding: 12px; border-radius: 8px; margin-top: 16px; border-left: 4px solid #fbc02d;">
            <p style="margin: 0;"><strong>ğŸ’¡ Máº¹o há»c phrasal verbs:</strong></p>
            <ul style="margin-top: 8px;">
              <li>Há»c theo nhÃ³m Ä‘á»™ng tá»« giá»‘ng nhau (look, get, set, hand...)</li>
              <li>Há»c kÃ¨m vá»›i vÃ­ dá»¥ thá»±c táº¿, Ä‘á»«ng chá»‰ há»c nghÄ©a riÃªng láº»</li>
              <li>ChÃº Ã½ má»™t Ä‘á»™ng tá»« + cÃ¡c giá»›i tá»« khÃ¡c nhau sáº½ cÃ³ nghÄ©a hoÃ n toÃ n khÃ¡c nhau</li>
              <li>Thá»±c hÃ nh thÆ°á»ng xuyÃªn qua cÃ¡c bÃ i táº­p dÆ°á»›i Ä‘Ã¢y</li>
            </ul>
          </div>
        </div>

      </div>
    </div>
    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/student-name-manager.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'g9-unit-1-local-community';
    const DATA_PATH = '../data/g9-unit-1-local-community.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x ğŸ”¥';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      // Initialize student name
      StudentNameManager.init();
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
