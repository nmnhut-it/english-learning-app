<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit 6: Day Trip - Be Going To | English Grammar Games</title>
  <meta name="description" content="Practice 'be going to' for plans, intentions, and predictions">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Unit 6: Day Trip</h1>
          <p class="game-header__subtitle">Be Going To - Plans & Predictions</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">Gi√°o vi√™n:</span>
              <span class="game-info__value">Nguy·ªÖn Minh Nh·ª±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">H·ªçc sinh:</span>
              <span class="game-info__value"></span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">ƒêi·ªÉm</span>
            <span class="stat__value stat__value--primary" id="current-score">‚≠ê 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Ti·∫øn ƒë·ªô</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>T√†i li·ªáu ng·ªØ ph√°p (Grammar notes)</span>
        <span class="theory-panel__icon" id="theory-icon">‚ñº</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">1. Khi n√†o d√πng 'BE GOING TO'?</h3>

          <p><strong>A. N√≥i v·ªÅ K·∫æ HO·∫†CH / √ù ƒê·ªäNH ƒë√£ quy·∫øt ƒë·ªãnh t·ª´ TR∆Ø·ªöC:</strong></p>
          <ul>
            <li>B·∫°n ƒë√£ suy nghƒ© v√† quy·∫øt ƒë·ªãnh tr∆∞·ªõc khi n√≥i</li>
            <li><em>I'm going to visit my grandmother next week.</em> (T√¥i s·∫Ω thƒÉm b√† tu·∫ßn t·ªõi - ƒë√£ l√™n k·∫ø ho·∫°ch)</li>
            <li><em>We're going to buy a new car.</em> (Ch√∫ng t√¥i s·∫Ω mua xe m·ªõi - ƒë√£ quy·∫øt ƒë·ªãnh)</li>
          </ul>

          <p><strong>B. D·ª± ƒëo√°n d·ª±a tr√™n B·∫∞NG CH·ª®NG NH√åN TH·∫§Y (evidence you can see):</strong></p>
          <ul>
            <li>B·∫°n TH·∫§Y ƒëi·ªÅu g√¨ ƒë√≥ v√† d·ª± ƒëo√°n chuy·ªán s·∫Ω x·∫£y ra</li>
            <li><em>Look at those clouds! It's going to rain.</em> (Nh√¨n m√¢y ƒëen k√¨a! Tr·ªùi s·∫Øp m∆∞a - th·∫•y m√¢y ƒëen)</li>
            <li><em>Watch out! You're going to fall!</em> (Coi ch·ª´ng! B·∫°n s·∫Øp ng√£! - th·∫•y ng∆∞·ªùi ƒë√≥ s·∫Øp ng√£)</li>
            <li><em>She looks tired. She's going to sit down.</em> (C√¥ ·∫•y tr√¥ng m·ªát. C√¥ ·∫•y s·∫Ω ng·ªìi xu·ªëng - th·∫•y v·∫ª m·ªát)</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">2. C·∫•u tr√∫c c√¢u KH·∫≤NG ƒê·ªäNH</h3>
          <p><strong>C√¥ng th·ª©c:</strong> Subject + am/is/are + going to + Verb (nguy√™n m·∫´u)</p>

          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Ch·ªß ng·ªØ</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Be</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">V√≠ d·ª•</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">I</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>am</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;">I <strong>am going to visit</strong> the zoo.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">He/She/It</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>is</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;">He <strong>is going to see</strong> the lions.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">We/You/They</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>are</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;">They <strong>are going to learn</strong> about reptiles.</td>
              </tr>
            </table>
            <p><strong>Vi·∫øt t·∫Øt th√¥ng d·ª•ng:</strong> I'm going to... / He's going to... / They're going to...</p>
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">3. C·∫•u tr√∫c c√¢u PH·ª¶ ƒê·ªäNH</h3>
          <p><strong>C√¥ng th·ª©c:</strong> Subject + am/is/are + NOT + going to + Verb</p>

          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Ch·ªß ng·ªØ</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Ph·ªß ƒë·ªãnh</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">V√≠ d·ª•</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">I</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>am not</strong> going to</td>
                <td style="border: 1px solid #ddd; padding: 8px;">I <strong>am not going to</strong> eat that.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">He/She/It</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>is not / isn't</strong> going to</td>
                <td style="border: 1px solid #ddd; padding: 8px;">She <strong>isn't going to</strong> come.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">We/You/They</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>are not / aren't</strong> going to</td>
                <td style="border: 1px solid #ddd; padding: 8px;">They <strong>aren't going to</strong> play.</td>
              </tr>
            </table>
            <p><strong>L∆∞u √Ω:</strong> 'I am not' KH√îNG vi·∫øt t·∫Øt th√†nh 'I amn't' - ch·ªâ vi·∫øt 'I'm not'</p>
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">4. C·∫•u tr√∫c c√¢u H·ªéI</h3>

          <p><strong>A. C√¢u h·ªèi Yes/No:</strong></p>
          <p><strong>C√¥ng th·ª©c:</strong> Am/Is/Are + Subject + going to + Verb...?</p>

          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">C√¢u h·ªèi</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Tr·∫£ l·ªùi KH·∫≤NG ƒê·ªäNH</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Tr·∫£ l·ªùi PH·ª¶ ƒê·ªäNH</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Am</strong> I going to pass?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Yes, you <strong>are</strong>.</td>
                <td style="border: 1px solid #ddd; padding: 8px;">No, you <strong>aren't</strong>.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Is</strong> he going to come?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Yes, he <strong>is</strong>.</td>
                <td style="border: 1px solid #ddd; padding: 8px;">No, he <strong>isn't</strong>.</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Are</strong> they going to play?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Yes, they <strong>are</strong>.</td>
                <td style="border: 1px solid #ddd; padding: 8px;">No, they <strong>aren't</strong>.</td>
              </tr>
            </table>
            <p style="color: var(--danger);"><strong>‚ö†Ô∏è QUY T·∫ÆC QUAN TR·ªåNG v·ªÅ tr·∫£ l·ªùi ng·∫Øn:</strong></p>
            <ul>
              <li>Tr·∫£ l·ªùi KH·∫≤NG ƒê·ªäNH: <strong>KH√îNG</strong> vi·∫øt t·∫Øt ‚Üí 'Yes, I am.' (kh√¥ng ph·∫£i 'Yes, I'm.')</li>
              <li>Tr·∫£ l·ªùi PH·ª¶ ƒê·ªäNH: C√ì TH·ªÇ vi·∫øt t·∫Øt ‚Üí 'No, I'm not.' ho·∫∑c 'No, he isn't.'</li>
            </ul>
          </div>

          <p><strong>B. C√¢u h·ªèi WH- (What, Where, When, Why, How, Who):</strong></p>
          <p><strong>C√¥ng th·ª©c:</strong> WH-word + am/is/are + Subject + going to + Verb...?</p>

          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">T·ª´ h·ªèi</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">V√≠ d·ª•</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>What</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>What are</strong> you <strong>going to do</strong>? (B·∫°n ƒë·ªãnh l√†m g√¨?)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Where</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Where is</strong> she <strong>going to go</strong>? (C√¥ ·∫•y ƒë·ªãnh ƒëi ƒë√¢u?)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>When</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>When are</strong> they <strong>going to arrive</strong>? (H·ªç ƒë·ªãnh ƒë·∫øn khi n√†o?)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Why</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Why is</strong> he <strong>going to leave</strong>? (T·∫°i sao anh ·∫•y ƒë·ªãnh ƒëi?)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>How</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>How are</strong> you <strong>going to travel</strong>? (B·∫°n ƒë·ªãnh ƒëi b·∫±ng g√¨?)</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">5. Ph√¢n bi·ªát 'BE GOING TO' v√† 'WILL'</h3>

          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left; width: 50%;">BE GOING TO</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left; width: 50%;">WILL</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">K·∫ø ho·∫°ch ƒë√£ quy·∫øt ƒë·ªãnh <strong>TR∆Ø·ªöC</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;">Quy·∫øt ƒë·ªãnh <strong>NGAY L√öC N√ìI</strong></td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><em>I'm going to buy a car.</em> (ƒë√£ l√™n k·∫ø ho·∫°ch)</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><em>I'll buy a car.</em> (quy·∫øt ƒë·ªãnh ngay)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">D·ª± ƒëo√°n c√≥ <strong>B·∫∞NG CH·ª®NG NH√åN TH·∫§Y</strong></td>
                <td style="border: 1px solid #ddd; padding: 8px;">D·ª± ƒëo√°n <strong>CHUNG CHUNG</strong> (nghƒ©, tin)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;"><em>Look! It's going to rain.</em> (th·∫•y m√¢y)</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><em>I think it will rain tomorrow.</em> (nghƒ© v·∫≠y)</td>
              </tr>
            </table>
            <p><strong>V√≠ d·ª• so s√°nh:</strong></p>
            <ul>
              <li>Phone rings ‚Üí 'I<strong>'ll</strong> answer it!' (quy·∫øt ƒë·ªãnh ngay khi nghe chu√¥ng)</li>
              <li>'I<strong>'m going to</strong> call Mom tonight.' (ƒë√£ l√™n k·∫ø ho·∫°ch t·ª´ tr∆∞·ªõc)</li>
            </ul>
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">6. C√°c l·ªói th∆∞·ªùng g·∫∑p (Common Mistakes)</h3>
          <div class="theory-panel__example">
            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
              <tr style="background: var(--bg-light);">
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">‚ùå SAI</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">‚úÖ ƒê√öNG</th>
                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Gi·∫£i th√≠ch</th>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">I going to visit...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">I <strong>am</strong> going to visit...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Thi·∫øu 'am/is/are'</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">She is go to study...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">She is <strong>going</strong> to study...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Ph·∫£i l√† 'going' (th√™m -ing)</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">Are you going visit...?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Are you going <strong>to</strong> visit...?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Thi·∫øu 'to'</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">going to watching...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">going to <strong>watch</strong>...</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Sau 'to' d√πng V nguy√™n m·∫´u</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">Does she going to...?</td>
                <td style="border: 1px solid #ddd; padding: 8px;"><strong>Is</strong> she going to...?</td>
                <td style="border: 1px solid #ddd; padding: 8px;">D√πng 'Is/Are', kh√¥ng d√πng 'Does/Do'</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">gonna (vi·∫øt)</td>
                <td style="border: 1px solid #ddd; padding: 8px;">going to</td>
                <td style="border: 1px solid #ddd; padding: 8px;">'gonna' ch·ªâ d√πng n√≥i, kh√¥ng vi·∫øt</td>
              </tr>
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">Yes, I'm.</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Yes, I <strong>am</strong>.</td>
                <td style="border: 1px solid #ddd; padding: 8px;">Tr·∫£ l·ªùi kh·∫≥ng ƒë·ªãnh kh√¥ng vi·∫øt t·∫Øt</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>
  <script src="../js/exercises/fill-blank.js"></script>
  <script src="../js/exercises/sentence-build.js"></script>
  <script src="../js/exercises/error-correct.js"></script>
  <script src="../js/exercises/dialogue-complete.js"></script>
  <script src="../js/exercises/translation.js"></script>
  <script src="../js/exercises/open-ended.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'unit-6-day-trip';
    const DATA_PATH = '../data/unit-6-day-trip.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x üî•';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
