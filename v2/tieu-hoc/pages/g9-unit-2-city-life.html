<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade 9 - Unit 2: City Life | English Grammar Games</title>
  <meta name="description" content="Practice double comparatives and phrasal verbs about city life">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="../css/shared.css">
</head>
<body>
  <!-- Game Header -->
  <header class="game-header">
    <div class="container">
      <div class="game-header__container">
        <div class="game-header__info-section">
          <h1 class="game-header__title">Grade 9 - Unit 2: City Life</h1>
          <p class="game-header__subtitle">Double Comparatives & Phrasal Verbs</p>
          <div class="game-info">
            <div class="game-info__item">
              <span class="game-info__label">Gi√°o vi√™n:</span>
              <span class="game-info__value">Nguy·ªÖn Minh Nh·ª±t</span>
            </div>
            <div class="game-info__item">
              <span class="game-info__label">H·ªçc sinh:</span>
              <span class="game-info__value">L·ªõp 9</span>
            </div>
          </div>
        </div>

        <div class="game-header__stats">
          <div class="stat">
            <span class="stat__label">ƒêi·ªÉm</span>
            <span class="stat__value stat__value--primary" id="current-score">‚≠ê 0</span>
          </div>

          <div class="stat">
            <span class="stat__label">Ti·∫øn ƒë·ªô</span>
            <span class="stat__value" id="progress-count">0 / 0</span>
          </div>

          <div class="stat" id="combo-display" style="display: none;">
            <span class="stat__label">Combo</span>
            <span class="stat__value" id="combo-count">0</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress">
        <div class="progress__bar" id="progress-bar" style="width: 0%;"></div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Theory Panel (Collapsible) -->
    <div class="theory-panel" id="theory-panel">
      <button class="theory-panel__toggle" id="theory-toggle">
        <span>üìñ T√†i li·ªáu ng·ªØ ph√°p</span>
        <span class="theory-panel__icon" id="theory-icon">‚ñº</span>
      </button>

      <div class="theory-panel__content" id="theory-content">
        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">1. Double Comparatives (So s√°nh k√©p)</h3>

          <p><strong>üéØ C√¥ng d·ª•ng:</strong> Di·ªÖn t·∫£ m·ªëi quan h·ªá t·ª∑ l·ªá thu·∫≠n gi·ªØa hai s·ª± v·∫≠t/hi·ªán t∆∞·ª£ng - khi c√°i n√†y tƒÉng/gi·∫£m th√¨ c√°i kia c≈©ng tƒÉng/gi·∫£m theo</p>

          <p><strong>üìù C·∫•u tr√∫c chung:</strong></p>
          <p class="text-center" style="font-size: 1.2em; color: var(--primary); background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>The + comparative..., the + comparative...</strong><br>
            <span style="font-size: 0.85em;">(C√†ng... th√¨ c√†ng...)</span>
          </p>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">2. C√°c c√°ch th√†nh l·∫≠p so s√°nh k√©p</h3>

          <p><strong>A. V·ªõi t√≠nh t·ª´ ng·∫Øn (1 √¢m ti·∫øt):</strong></p>
          <p class="text-center" style="background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>The + adjective + -er..., the + adjective + -er...</strong>
          </p>
          <div class="theory-panel__example">
            <strong>‚úÖ V√≠ d·ª•:</strong><br>
            ‚Ä¢ The <strong>higher</strong> you climb, the <strong>colder</strong> it gets.<br>
            ‚Üí C√†ng leo cao, tr·ªùi c√†ng l·∫°nh.<br><br>
            ‚Ä¢ The <strong>faster</strong> you run, the <strong>sooner</strong> you arrive.<br>
            ‚Üí B·∫°n ch·∫°y c√†ng nhanh, b·∫°n c√†ng ƒë·∫øn s·ªõm.<br><br>
            ‚Ä¢ The <strong>older</strong> we get, the <strong>wiser</strong> we become.<br>
            ‚Üí C√†ng l·ªõn tu·ªïi, ta c√†ng kh√¥n ngoan.
          </div>

          <p><strong>B. V·ªõi t√≠nh t·ª´ d√†i (2+ √¢m ti·∫øt):</strong></p>
          <p class="text-center" style="background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>The more + adjective..., the more + adjective...</strong>
          </p>
          <div class="theory-panel__example">
            <strong>‚úÖ V√≠ d·ª•:</strong><br>
            ‚Ä¢ The <strong>more crowded</strong> the city gets, the <strong>more congested</strong> it becomes.<br>
            ‚Üí Th√†nh ph·ªë c√†ng ƒë√¥ng ƒë√∫c, c√†ng tr·ªü n√™n t·∫Øc ngh·∫Ωn.<br><br>
            ‚Ä¢ The <strong>more expensive</strong> it is, the <strong>more difficult</strong> it is to afford.<br>
            ‚Üí C√†ng ƒë·∫Øt, c√†ng kh√≥ mua ƒë∆∞·ª£c.<br><br>
            ‚Ä¢ The <strong>more beautiful</strong> the view, the <strong>more peaceful</strong> you feel.<br>
            ‚Üí Phong c·∫£nh c√†ng ƒë·∫πp, b·∫°n c√†ng c·∫£m th·∫•y y√™n b√¨nh.
          </div>

          <p><strong>C. V·ªõi t√≠nh t·ª´ 2 √¢m ti·∫øt k·∫øt th√∫c b·∫±ng -y, -er, -ow:</strong></p>
          <div class="theory-panel__example">
            <strong>Chuy·ªÉn -y ‚Üí -ier:</strong><br>
            ‚Ä¢ The <strong>busier</strong> the street, the <strong>noisier</strong> it gets.<br>
            ‚Üí ƒê∆∞·ªùng c√†ng ƒë√¥ng, c√†ng ·ªìn √†o.<br><br>
            ‚Ä¢ The <strong>earlier</strong> you start, the <strong>easier</strong> it is.<br>
            ‚Üí B·∫°n b·∫Øt ƒë·∫ßu c√†ng s·ªõm, c√†ng d·ªÖ d√†ng.
          </div>

          <p><strong>D. V·ªõi ƒë·ªông t·ª´:</strong></p>
          <p class="text-center" style="background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>The more + S + V..., the more + S + V...</strong>
          </p>
          <div class="theory-panel__example">
            <strong>‚úÖ V√≠ d·ª•:</strong><br>
            ‚Ä¢ The <strong>more you practice</strong>, the <strong>better you become</strong>.<br>
            ‚Üí C√†ng luy·ªán t·∫≠p nhi·ªÅu, b·∫°n c√†ng gi·ªèi h∆°n.<br><br>
            ‚Ä¢ The <strong>more he studies</strong>, the <strong>smarter he gets</strong>.<br>
            ‚Üí C√†ng h·ªçc nhi·ªÅu, anh ·∫•y c√†ng th√¥ng minh.
          </div>

          <p><strong>E. V·ªõi danh t·ª´:</strong></p>
          <p class="text-center" style="background: var(--bg-light); padding: 10px; border-radius: 8px;">
            <strong>The more + noun..., the more + noun...</strong><br>
            <strong>The fewer/less + noun..., the fewer/less + noun...</strong>
          </p>
          <div class="theory-panel__example">
            <strong>‚úÖ V√≠ d·ª•:</strong><br>
            ‚Ä¢ The <strong>more money</strong> you earn, the <strong>more taxes</strong> you pay.<br>
            ‚Üí C√†ng ki·∫øm nhi·ªÅu ti·ªÅn, b·∫°n c√†ng ƒë√≥ng nhi·ªÅu thu·∫ø.<br><br>
            ‚Ä¢ The <strong>fewer mistakes</strong> you make, the <strong>better grades</strong> you get.<br>
            ‚Üí C√†ng √≠t l·ªói sai, b·∫°n c√†ng ƒë∆∞·ª£c ƒëi·ªÉm cao.
          </div>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">3. T√≠nh t·ª´ b·∫•t quy t·∫Øc trong so s√°nh k√©p</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: var(--bg-light);">
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">T√≠nh t·ª´</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">So s√°nh h∆°n</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">V√≠ d·ª•</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>good</strong> (t·ªët)</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>better</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">The <strong>better</strong> you prepare, the <strong>better</strong> you perform.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>bad</strong> (t·ªá)</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>worse</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">The <strong>worse</strong> the traffic, the <strong>later</strong> we arrive.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>far</strong> (xa)</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>farther/further</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">The <strong>farther</strong> we walk, the <strong>more tired</strong> we get.</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>little</strong> (√≠t)</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>less</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">The <strong>less</strong> you eat, the <strong>hungrier</strong> you feel.</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>many/much</strong> (nhi·ªÅu)</td>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>more</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">The <strong>more</strong> friends you have, the <strong>happier</strong> you are.</td>
            </tr>
          </table>

          <p class="text-note"><strong>üí° M·∫πo nh·ªõ:</strong></p>
          <ul>
            <li>Lu√¥n c√≥ <strong>THE</strong> ·ªü c·∫£ hai v·∫ø</li>
            <li>C·∫£ hai v·∫ø ƒë·ªÅu d√πng d·∫°ng so s√°nh h∆°n</li>
            <li>D·∫•u ph·∫©y (,) ngƒÉn c√°ch hai v·∫ø</li>
            <li>V·∫ø ƒë·∫ßu l√† nguy√™n nh√¢n ‚Üí V·∫ø sau l√† k·∫øt qu·∫£</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">4. Phrasal Verbs v·ªÅ City Life</h3>

          <p><strong>üéØ C√¥ng d·ª•ng:</strong> C·ª•m ƒë·ªông t·ª´ (phrasal verb) l√† ƒë·ªông t·ª´ k·∫øt h·ª£p v·ªõi gi·ªõi t·ª´/tr·∫°ng t·ª´ t·∫°o th√†nh nghƒ©a m·ªõi</p>

          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: var(--bg-light);">
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Phrasal Verb</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Nghƒ©a</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">V√≠ d·ª•</th>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>get around</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">ƒëi l·∫°i (trong th√†nh ph·ªë)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">We can <strong>get around</strong> the city by metro.<br>(Ch√∫ng ta c√≥ th·ªÉ ƒëi l·∫°i trong th√†nh ph·ªë b·∫±ng t√†u ƒëi·ªán ng·∫ßm.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>carry out</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">th·ª±c hi·ªán (nghi√™n c·ª©u, d·ª± √°n)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>carried out</strong> a survey about city life.<br>(H·ªç th·ª±c hi·ªán m·ªôt cu·ªôc kh·∫£o s√°t v·ªÅ cu·ªôc s·ªëng th√†nh ph·ªë.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>come down with</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">m·∫Øc b·ªánh, nhi·ªÖm b·ªánh</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>came down with</strong> the flu.<br>(C√¥ ·∫•y b·ªã c·∫£m c√∫m.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>hang out</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">ƒëi ch∆°i, g·∫∑p g·ª° b·∫°n b√®</td>
              <td style="padding: 10px; border: 1px solid #ddd;">Teenagers <strong>hang out</strong> at shopping malls.<br>(Thanh thi·∫øu ni√™n ƒëi ch∆°i ·ªü trung t√¢m mua s·∫Øm.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>cut down on</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">c·∫Øt gi·∫£m, gi·∫£m b·ªõt</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The city is trying to <strong>cut down on</strong> air pollution.<br>(Th√†nh ph·ªë ƒëang c·ªë c·∫Øt gi·∫£m √¥ nhi·ªÖm kh√¥ng kh√≠.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>get stuck in</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">b·ªã k·∫πt (trong t·∫Øc ƒë∆∞·ªùng)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">I often <strong>get stuck in</strong> traffic jams.<br>(T√¥i th∆∞·ªùng b·ªã k·∫πt trong t·∫Øc ƒë∆∞·ªùng.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>look around</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">ng·∫Øm ngh√≠a, nh√¨n xung quanh</td>
              <td style="padding: 10px; border: 1px solid #ddd;">Let's <strong>look around</strong> the museum.<br>(H√£y ng·∫Øm ngh√≠a b·∫£o t√†ng.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>set up</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">th√†nh l·∫≠p, thi·∫øt l·∫≠p</td>
              <td style="padding: 10px; border: 1px solid #ddd;">They <strong>set up</strong> a new business in the city.<br>(H·ªç th√†nh l·∫≠p m·ªôt doanh nghi·ªáp m·ªõi trong th√†nh ph·ªë.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>turn down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">t·ª´ ch·ªëi</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>turned down</strong> the job offer.<br>(C√¥ ·∫•y t·ª´ ch·ªëi l·ªùi m·ªùi vi·ªác.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>close down</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">ƒë√≥ng c·ª≠a (vƒ©nh vi·ªÖn)</td>
              <td style="padding: 10px; border: 1px solid #ddd;">The factory <strong>closed down</strong> last year.<br>(Nh√† m√°y ƒë√≥ng c·ª≠a nƒÉm ngo√°i.)</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>deal with</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">gi·∫£i quy·∫øt, x·ª≠ l√Ω</td>
              <td style="padding: 10px; border: 1px solid #ddd;">Cities must <strong>deal with</strong> traffic problems.<br>(Th√†nh ph·ªë ph·∫£i gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ giao th√¥ng.)</td>
            </tr>
            <tr style="background: var(--bg-light);">
              <td style="padding: 10px; border: 1px solid #ddd;"><strong>live on</strong></td>
              <td style="padding: 10px; border: 1px solid #ddd;">s·ªëng nh·ªù v√†o</td>
              <td style="padding: 10px; border: 1px solid #ddd;">She <strong>lives on</strong> a small salary.<br>(C√¥ ·∫•y s·ªëng nh·ªù v√†o l∆∞∆°ng th·∫•p.)</td>
            </tr>
          </table>

          <p class="text-note"><strong>üí° Ph√¢n lo·∫°i Phrasal Verbs:</strong></p>
          <ul>
            <li><strong>Separable</strong> (c√≥ th·ªÉ t√°ch): carry out ‚Üí carry the survey out</li>
            <li><strong>Inseparable</strong> (kh√¥ng th·ªÉ t√°ch): get around ‚Üí ‚úó get the city around</li>
            <li><strong>3-part phrasal verbs</strong>: come down with, cut down on, get stuck in</li>
          </ul>
        </div>

        <div class="theory-panel__section">
          <h3 class="theory-panel__heading">5. T·ª´ v·ª±ng v·ªÅ City Life (Cu·ªôc s·ªëng th√†nh th·ªã)</h3>

          <p><strong>üèôÔ∏è ∆Øu ƒëi·ªÉm c·ªßa th√†nh ph·ªë:</strong></p>
          <ul>
            <li><strong>modern facilities</strong> - c∆° s·ªü v·∫≠t ch·∫•t hi·ªán ƒë·∫°i</li>
            <li><strong>job opportunities</strong> - c∆° h·ªôi vi·ªác l√†m</li>
            <li><strong>public transport</strong> - giao th√¥ng c√¥ng c·ªông</li>
            <li><strong>entertainment</strong> - gi·∫£i tr√≠</li>
            <li><strong>shopping centers</strong> - trung t√¢m mua s·∫Øm</li>
          </ul>

          <p><strong>‚ö†Ô∏è Nh∆∞·ª£c ƒëi·ªÉm c·ªßa th√†nh ph·ªë:</strong></p>
          <ul>
            <li><strong>traffic congestion</strong> - t·∫Øc ngh·∫Ωn giao th√¥ng</li>
            <li><strong>air pollution</strong> - √¥ nhi·ªÖm kh√¥ng kh√≠</li>
            <li><strong>noise pollution</strong> - √¥ nhi·ªÖm ti·∫øng ·ªìn</li>
            <li><strong>high cost of living</strong> - chi ph√≠ sinh ho·∫°t cao</li>
            <li><strong>overcrowding</strong> - ƒë√¥ng ƒë√∫c qu√° m·ª©c</li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Exercise Container -->
    <div id="exercise-container">
      <!-- Exercises will be rendered here dynamically -->
      <div class="card text-center">
        <h2>Loading...</h2>
        <p>Please wait while we load the exercises.</p>
      </div>
    </div>
  </main>

  <!-- Core JavaScript (loaded first) -->
  <script src="../js/core/utils.js"></script>
  <script src="../js/core/storage.js"></script>
  <script src="../js/core/telegram-sender.js"></script>
  <script src="../js/core/student-name-manager.js"></script>
  <script src="../js/core/game-engine.js"></script>

  <!-- Exercise Type Handlers (mobile-friendly types only) -->
  <script src="../js/exercises/multiple-choice.js"></script>
  <script src="../js/exercises/word-rearrange.js"></script>

  <!-- Initialize Game -->
  <script>
    const UNIT_ID = 'g9-unit-2-city-life';
    const DATA_PATH = '../data/g9-unit-2-city-life.json';

    // Theory panel toggle
    const theoryToggle = document.getElementById('theory-toggle');
    const theoryContent = document.getElementById('theory-content');
    const theoryIcon = document.getElementById('theory-icon');

    theoryToggle.addEventListener('click', () => {
      const isExpanded = theoryContent.classList.contains('theory-panel__content--expanded');

      if (isExpanded) {
        theoryContent.classList.remove('theory-panel__content--expanded');
        theoryIcon.classList.remove('theory-panel__icon--rotated');
      } else {
        theoryContent.classList.add('theory-panel__content--expanded');
        theoryIcon.classList.add('theory-panel__icon--rotated');
      }
    });

    // Combo display logic
    function updateComboDisplay() {
      const comboDisplay = document.getElementById('combo-display');
      const comboCount = document.getElementById('combo-count');
      const state = GameEngine.getState();

      if (state.comboCount >= 3) {
        comboDisplay.style.display = 'flex';
        comboCount.textContent = state.comboCount + 'x üî•';
      } else {
        comboDisplay.style.display = 'none';
      }
    }

    // Override GameEngine.updateUI to include combo display
    const originalUpdateUI = GameEngine.updateUI.bind(GameEngine);
    GameEngine.updateUI = function() {
      originalUpdateUI();
      updateComboDisplay();
    };

    // Load unit data and start game
    async function loadAndStartGame() {
      // Initialize student name
      StudentNameManager.init();
      try {
        const response = await fetch(DATA_PATH);

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status}`);
        }

        const unitData = await response.json();

        console.log('Unit data loaded:', unitData);
        console.log('Registered exercise handlers:', Object.keys(GameEngine.exerciseHandlers));

        GameEngine.init(unitData, UNIT_ID);

      } catch (error) {
        console.error('Error loading game data:', error);

        const container = document.getElementById('exercise-container');
        container.innerHTML = `
          <div class="card">
            <h2 style="color: var(--danger);">Error Loading Game</h2>
            <p>Sorry, we couldn't load the exercise data. Please try refreshing the page.</p>
            <p style="font-size: var(--font-size-sm); color: var(--text-light);">Error: ${error.message}</p>
            <button class="btn btn--primary mt-2" onclick="location.reload()">Reload Page</button>
          </div>
        `;
      }
    }

    // Start game when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadAndStartGame);
    } else {
      loadAndStartGame();
    }
  </script>
</body>
</html>
