<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Vocabulary Helper</title>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 0.75rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        /* Main Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            min-height: calc(100vh - 73px);
        }
        
        /* Welcome Section */
        .welcome-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .welcome-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .welcome-text {
            color: var(--gray-600);
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .steps {
            display: grid;
            gap: 1rem;
            margin-top: 1.5rem;
            text-align: left;
        }
        
        .step {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            align-items: flex-start;
        }
        
        .step-number {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .step-content h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .step-content p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        /* Form Card */
        .form-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }
        
        .form-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        
        .required {
            color: var(--error);
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
            -webkit-appearance: none;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        
        .help-text {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.25rem;
        }
        
        .help-icon {
            flex-shrink: 0;
            margin-top: 0.125rem;
        }
        
        /* Grid for form fields */
        .form-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .form-grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Submit Button */
        .submit-button {
            width: 100%;
            padding: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            touch-action: manipulation;
        }
        
        .submit-button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .submit-button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .submit-button:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
        }
        
        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Result Section */
        .result-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .result-card.show {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .result-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .result-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .icon-button {
            padding: 0.5rem;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            gap: 0.375rem;
        }
        
        .icon-button:hover {
            background: var(--gray-200);
            color: var(--gray-900);
        }
        
        .icon-button.copied {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            font-size: 0.875rem;
        }
        
        .message-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
        }
        
        .message.success {
            background: #10b98119;
            color: var(--success);
            border: 1px solid #10b98133;
        }
        
        .message.error {
            background: #ef444419;
            color: var(--error);
            border: 1px solid #ef444433;
        }
        
        /* Markdown Preview */
        .markdown-preview {
            background: var(--gray-50);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-200);
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .markdown-preview h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
        }
        
        .markdown-preview h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        .markdown-preview p {
            margin-bottom: 1rem;
            color: var(--gray-700);
        }
        
        .markdown-preview strong {
            color: var(--gray-900);
            font-weight: 600;
        }
        
        .markdown-preview em {
            font-style: italic;
            color: var(--gray-600);
        }
        
        .markdown-preview ul,
        .markdown-preview ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }
        
        .markdown-preview li {
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }
        
        .markdown-preview hr {
            border: none;
            border-top: 1px solid var(--gray-300);
            margin: 1.5rem 0;
        }
        
        .markdown-preview code {
            background: var(--gray-200);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875em;
        }
        
        .markdown-preview pre {
            background: var(--gray-900);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        .markdown-preview pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }
            
            .welcome-card,
            .form-card,
            .result-card {
                padding: 1rem;
            }
            
            .steps {
                gap: 0.75rem;
            }
            
            .step {
                padding: 0.75rem;
            }
            
            .form-grid-2,
            .form-grid-3 {
                grid-template-columns: 1fr;
            }
            
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .result-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
        }
        
        .tooltip-text {
            visibility: hidden;
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-900);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s, visibility 0.2s;
            margin-bottom: 0.5rem;
        }
        
        .tooltip-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--gray-900);
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Focus visible for accessibility */
        button:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        .header-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-size: 0.75rem;
            color: var(--gray-600);
            gap: 0.125rem;
        }
        
        .header-author {
            font-weight: 500;
        }
        
        .header-price {
            color: var(--primary);
            font-weight: 600;
        }
        
        @media (max-width: 640px) {
            .header-content {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .header-info {
                align-items: center;
                font-size: 0.7rem;
            }
        }
        
        /* Placeholder examples */
        .example-text {
            color: var(--gray-500);
            font-size: 0.875rem;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üìö</div>
                <span>English Vocabulary Helper</span>
            </div>
            <div class="header-info">
                <div class="header-author">Vi·∫øt b·ªüi Nguy·ªÖn Minh Nh·ª±t</div>
                <div class="header-price">5,000 VND/l∆∞·ª£t/10 t·ª´</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Form Section -->
        <div class="form-card animate__animated animate__fadeIn">
            <h2 class="form-title">
                <span>üìù</span>
                <span>Nh·∫≠p th√¥ng tin</span>
            </h2>
            
            <form id="vocabularyForm">
                <!-- API Key -->
                <div class="form-group">
                    <label for="apiKey" class="form-label">
                        Gemini API Key <span class="required">*</span>
                    </label>
                    <input 
                        type="password" 
                        id="apiKey" 
                        class="form-input"
                        required
                        placeholder="AIzaSy..."
                        autocomplete="off"
                    >
                    <div class="help-text">
                        <svg class="help-icon" width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <span>API key s·∫Ω ƒë∆∞·ª£c l∆∞u trong tr√¨nh duy·ªát cho l·∫ßn s·ª≠ d·ª•ng sau</span>
                    </div>
                </div>

                <!-- Words Input -->
                <div class="form-group">
                    <label for="words" class="form-label">
                        T·ª´ v·ª±ng (m·ªói t·ª´ m·ªôt d√≤ng) <span class="required">*</span>
                    </label>
                    <textarea 
                        id="words" 
                        class="form-textarea"
                        required
                        placeholder="beautiful
take care of
run out of
get up early"
                        rows="6"
                    ></textarea>
                    <div class="help-text">
                        <svg class="help-icon" width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h2a1 1 0 100-2H6V7h8v6h-2a1 1 0 100 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a1 1 0 100 2h2v6H6V7z" clip-rule="evenodd"/>
                        </svg>
                        <span>Nh·∫≠p t·ª´ng t·ª´ ho·∫∑c c·ª•m t·ª´, m·ªói t·ª´ tr√™n m·ªôt d√≤ng ri√™ng</span>
                    </div>
                </div>

                <!-- Context -->
                <div class="form-group">
                    <label for="context" class="form-label">
                        Ng·ªØ c·∫£nh (kh√¥ng b·∫Øt bu·ªôc)
                    </label>
                    <textarea 
                        id="context" 
                        class="form-textarea"
                        placeholder="V√≠ d·ª•: Unit 1: Hobbies and Activities

B·∫°n c√≥ th·ªÉ th√™m n·ªôi dung d√†i, ghi ch√∫, ho·∫∑c ng·ªØ c·∫£nh chi ti·∫øt cho b√†i t·ª´ v·ª±ng ·ªü ƒë√¢y..."
                        rows="4"
                    ></textarea>
                    <div class="help-text">
                        <svg class="help-icon" width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <span>Th√™m n·ªôi dung, ti√™u ƒë·ªÅ, ho·∫∑c ng·ªØ c·∫£nh chi ti·∫øt cho b√†i t·ª´ v·ª±ng (c√≥ th·ªÉ vi·∫øt nhi·ªÅu d√≤ng)</span>
                    </div>
                </div>

                <!-- Grid Fields -->
                <div class="form-grid form-grid-2">
                    <!-- Grade -->
                    <div class="form-group">
                        <label for="grade" class="form-label">
                            L·ªõp <span class="required">*</span>
                        </label>
                        <select id="grade" class="form-select" required>
                            <option value="">Ch·ªçn l·ªõp</option>
                            <option value="1">L·ªõp 1</option>
                            <option value="2">L·ªõp 2</option>
                            <option value="3">L·ªõp 3</option>
                            <option value="4">L·ªõp 4</option>
                            <option value="5">L·ªõp 5</option>
                            <option value="6">L·ªõp 6</option>
                            <option value="7">L·ªõp 7</option>
                            <option value="8">L·ªõp 8</option>
                            <option value="9">L·ªõp 9</option>
                            <option value="10">L·ªõp 10</option>
                            <option value="11">L·ªõp 11</option>
                            <option value="12">L·ªõp 12</option>
                        </select>
                    </div>

                    <!-- Unit -->
                    <div class="form-group">
                        <label for="unit" class="form-label">
                            Unit <span class="required">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="unit" 
                            class="form-input"
                            min="1" 
                            max="20" 
                            required
                            placeholder="1"
                        >
                    </div>

                    <!-- Lesson -->
                    <div class="form-group">
                        <label for="lesson" class="form-label">
                            T√™n b√†i <span class="required">*</span>
                        </label>
                        <select id="lesson" class="form-select" required>
                            <option value="">Ch·ªçn b√†i h·ªçc</option>
                            <option value="getting-started">Getting Started</option>
                            <option value="a-closer-look-1">A Closer Look 1</option>
                            <option value="a-closer-look-2">A Closer Look 2</option>
                            <option value="communication">Communication</option>
                            <option value="skills-1">Skills 1</option>
                            <option value="skills-2">Skills 2</option>
                            <option value="looking-back">Looking Back</option>
                            <option value="project">Project</option>
                        </select>
                    </div>

                    <!-- Book -->
                    <div class="form-group">
                        <label for="book" class="form-label">
                            S√°ch gi√°o khoa
                        </label>
                        <select id="book" class="form-select">
                            <option value="global-success">Global Success</option>
                            <option value="english">English</option>
                            <option value="other">Kh√°c</option>
                        </select>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-button" id="submitButton">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>T·∫°o t·ª´ v·ª±ng</span>
                </button>
            </form>
        </div>

        <!-- Result Section -->
        <div id="resultCard" class="result-card">
            <div id="resultContent"></div>
        </div>
    </main>

    <script>
        // Configuration
        const API_URL = 'http://0.0.0.0:3001/api/vocabulary/process';
        
        // DOM Elements
        const form = document.getElementById('vocabularyForm');
        const submitButton = document.getElementById('submitButton');
        const resultCard = document.getElementById('resultCard');
        const resultContent = document.getElementById('resultContent');
        const apiKeyInput = document.getElementById('apiKey');
        
        // Lesson options for different grade levels
        const lessonOptions = {
            primary: [ // Grades 1-5
                { value: 'lesson-1', text: 'Lesson 1' },
                { value: 'lesson-2', text: 'Lesson 2' },
                { value: 'lesson-3', text: 'Lesson 3' },
                { value: 'review', text: 'Review' }
            ],
            thcs: [ // Grades 6-9 (Global Success)
                { value: 'getting-started', text: 'Getting Started' },
                { value: 'a-closer-look-1', text: 'A Closer Look 1' },
                { value: 'a-closer-look-2', text: 'A Closer Look 2' },
                { value: 'communication', text: 'Communication' },
                { value: 'skills-1', text: 'Skills 1' },
                { value: 'skills-2', text: 'Skills 2' },
                { value: 'looking-back', text: 'Looking Back' },
                { value: 'project', text: 'Project' }
            ],
            thpt: [ // Grades 10-12 (Global Success)
                { value: 'getting-started', text: 'Getting Started' },
                { value: 'language', text: 'Language' },
                { value: 'reading', text: 'Reading' },
                { value: 'speaking', text: 'Speaking' },
                { value: 'listening', text: 'Listening' },
                { value: 'writing', text: 'Writing' },
                { value: 'communication-culture', text: 'Communication and Culture' },
                { value: 'looking-back-project', text: 'Looking Back and Project' }
            ]
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved API key
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
            
            // Configure marked options
            marked.setOptions({
                breaks: true,
                gfm: true,
                headerIds: false,
                mangle: false
            });
            
            // Load saved grade and trigger lesson update
            const savedGrade = localStorage.getItem('vocabularyGrade');
            if (savedGrade) {
                gradeSelect.value = savedGrade;
                gradeSelect.dispatchEvent(new Event('change'));
            }
        });
        
        // Save API key on change
        apiKeyInput.addEventListener('change', (e) => {
            localStorage.setItem('geminiApiKey', e.target.value.trim());
        });
        
        // Update lesson options based on grade
        const gradeSelect = document.getElementById('grade');
        const lessonSelect = document.getElementById('lesson');
        
        gradeSelect.addEventListener('change', (e) => {
            const grade = parseInt(e.target.value);
            if (!grade) return;
            
            // Save grade preference
            localStorage.setItem('vocabularyGrade', grade);
            
            // Clear current options
            lessonSelect.innerHTML = '<option value="">Ch·ªçn b√†i h·ªçc</option>';
            
            // Determine which lesson set to use
            let lessons;
            if (grade >= 1 && grade <= 5) {
                lessons = lessonOptions.primary;
            } else if (grade >= 6 && grade <= 9) {
                lessons = lessonOptions.thcs;
            } else {
                lessons = lessonOptions.thpt;
            }
            
            // Add new options
            lessons.forEach(lesson => {
                const option = document.createElement('option');
                option.value = lesson.value;
                option.textContent = lesson.text;
                lessonSelect.appendChild(option);
            });
        });
        
        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Get form data
            const formData = {
                apiKey: document.getElementById('apiKey').value.trim(),
                words: document.getElementById('words').value.trim(),
                context: document.getElementById('context').value.trim(),
                grade: document.getElementById('grade').value,
                unit: document.getElementById('unit').value,
                lesson: document.getElementById('lesson').value,
                book: document.getElementById('book').value || 'global-success'
            };
            
            // Validate
            if (!formData.apiKey || !formData.words || !formData.grade || !formData.unit || !formData.lesson) {
                showError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c th√¥ng tin b·∫Øt bu·ªôc');
                return;
            }
            
            // Show loading state
            setLoadingState(true);
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω t·ª´ v·ª±ng');
                }
                
                // Show success result
                showSuccess(data, formData.grade, formData.unit, formData.lesson);
                
            } catch (error) {
                showError(error.message);
            } finally {
                setLoadingState(false);
            }
        });
        
        // Helper functions
        function setLoadingState(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                submitButton.innerHTML = `
                    <div class="spinner"></div>
                    <span>ƒêang x·ª≠ l√Ω...</span>
                `;
            } else {
                submitButton.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>T·∫°o t·ª´ v·ª±ng</span>
                `;
            }
        }
        
        function showError(message) {
            resultContent.innerHTML = `
                <div class="message error animate__animated animate__fadeIn">
                    <svg class="message-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <div>
                        <strong>L·ªói:</strong> ${message}
                    </div>
                </div>
            `;
            resultCard.classList.add('show');
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function showSuccess(data, grade, unit, lesson) {
            // Sanitize and render markdown
            const sanitizedHTML = DOMPurify.sanitize(marked.parse(data.vocabulary));
            
            resultContent.innerHTML = `
                <div class="result-header">
                    <h3 class="result-title">
                        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor" style="color: var(--success);">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        T·∫°o t·ª´ v·ª±ng th√†nh c√¥ng! (${data.vocabularyCount} t·ª´)
                    </h3>
                    <div class="result-actions">
                        <button class="icon-button tooltip" onclick="copyToClipboard('${escapeHtml(data.vocabulary)}', this)">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                            </svg>
                            <span class="tooltip-text">Copy markdown</span>
                        </button>
                        <button class="icon-button tooltip" onclick="downloadMarkdown('vocabulary-grade-${grade}-unit-${String(unit).padStart(2, '0')}-${lesson}.md', '${escapeHtml(data.vocabulary)}')">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            <span class="tooltip-text">T·∫£i file</span>
                        </button>
                    </div>
                </div>
                
                <div class="markdown-preview">
                    ${sanitizedHTML}
                </div>
            `;
            
            resultCard.classList.add('show');
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                button.classList.add('copied');
                button.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    <span class="tooltip-text">ƒê√£ copy!</span>
                `;
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"/>
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"/>
                        </svg>
                        <span class="tooltip-text">Copy markdown</span>
                    `;
                }, 2000);
            });
        }
        
        function downloadMarkdown(filename, content) {
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Add some example vocabulary on click
        document.querySelector('textarea').addEventListener('focus', function() {
            if (this.value === '') {
                this.placeholder = `V√≠ d·ª•:
beautiful
take care of
run out of
get up early
homework
weekend`;
            }
        });
    </script>
</body>
</html>